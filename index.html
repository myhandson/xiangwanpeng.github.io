<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/VEN/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/VEN/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Better late than never.">
<meta property="og:type" content="website">
<meta property="og:title" content="向万鹏的独立博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="向万鹏的独立博客">
<meta property="og:description" content="Better late than never.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="向万鹏的独立博客">
<meta name="twitter:description" content="Better late than never.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> 向万鹏的独立博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">向万鹏的独立博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/14/SpringMVC中的异常处理/" itemprop="url">
                  SpringMVC中的异常处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-14T14:34:08+08:00" content="2016-11-14">
              2016-11-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/14/SpringMVC中的异常处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/14/SpringMVC中的异常处理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　Spring MVC通过HandlerExceptionResolver处理程序的异常，包括Handler 映射、数据绑定以及目标方法执行时发生的异常。在Eclipse中可以查看到HandleExceptionResolver接口的实现类：<br>　　<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/8592cvf1zunbe7npyd3excw9/image_1b1gosocup6i1ugoq3p119qdta9.png" alt="image_1b1gosocup6i1ugoq3p119qdta9.png-34.4kB"></p>
<p>　　如果我们没有在springmvc配置文件中配置&lt;mvc:annotation-driven/&gt;，那么DispatcherServlet会默认装配AnnotationMethodHandlerExceptionResolver、DefaultHandlerExceptionResolver和ResponseStatusException三种解析器，但是其中AnnotationMethodHandlerExceptionResolver已经过期了。所以我们配置&lt;mvc:annotation-driven/&gt;，将会把AnnotationMethodHandlerExceptionResolver替换为ExceptionHandlerExceptionResolver。<br>　　下面的例子中，我们都默认已经在spring配置文件中配置了&lt;mvc:annotation-driven/&gt;。</p>
<h2 id="ExceptionHandlerExceptionResolver"><a href="#ExceptionHandlerExceptionResolver" class="headerlink" title="ExceptionHandlerExceptionResolver"></a>ExceptionHandlerExceptionResolver</h2><p>　　ExceptionHandlerExceptionResolver主要用于处理Handler 中用@ExceptionHandler注解标记的方法，示例如下：</p>
<hr>
<p>页面<br>index.jsp<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;a href="testExceptionHandlerExceptionResolver?i=0"&gt;</div><div class="line">Test ExceptionHandlerExceptionResolver&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>error.jsp<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;h4&gt;Error Page&lt;/h4&gt;</div><div class="line">$&#123;exception &#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>控制器<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String ERROR = <span class="string">"error"</span>;</div><div class="line"></div><div class="line">    <span class="comment">//异常处理器</span></div><div class="line">    <span class="comment">//value = ArithmeticException.class声明捕获数学异常</span></div><div class="line">	<span class="meta">@ExceptionHandler</span>(value = ArithmeticException.class) </div><div class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleArithmeticException</span><span class="params">(Exception ex)</span> </span>&#123;</div><div class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(ERROR);</div><div class="line">		System.out.println(<span class="string">"出异常了："</span> + ex);</div><div class="line">		mv.addObject(<span class="string">"exception"</span>, ex);</div><div class="line">		<span class="keyword">return</span> mv;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    <span class="comment">//定义一个可以抛出ArithmeticException异常的方法</span></div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testExceptionHandlerExceptionResolver"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testExceptionHandlerExceptionResolver</span><span class="params">(@RequestParam(<span class="string">"i"</span>)</span> <span class="keyword">int</span> i) </span>&#123;</div><div class="line">		System.out.println(<span class="string">"result:"</span> + <span class="number">10</span> / i);</div><div class="line">		<span class="keyword">return</span> SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>运行程序：<br>点击index.jsp中的超链接，异常处理器会捕获到异常，在控制台输出：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/3idb7dwhyzptck6qqh1su3gv/image_1b1gqo9gavuv47c1s4lq8r1je9m.png" alt="image_1b1gqo9gavuv47c1s4lq8r1je9m.png-13.7kB"></p>
<p>并跳转到error.jsp，且在该页面打印了异常信息：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/ljj8q7gx7db1lukvxzdtqrwy/image_1b1gqpbg41slr1e5dccbvk91oju13.png" alt="image_1b1gqpbg41slr1e5dccbvk91oju13.png-12.6kB"></p>
<hr>
<p>需要注意的是：</p>
<ol>
<li>@ExceptionHandler标记的方法的入参中不能传入Map。 若希望把异常信息传导页面上, 需要使用 ModelAndView 作为返回值。</li>
<li>@ExceptionHandler 方法标记的异常有优先级的问题。如果我们在上面的例子中同时声明了可以捕获ArithmeticException异常和RuntimeException异常的两个异常处理器，那么会使用匹配度更高的，即捕获ArithmeticException异常的异常处理器。</li>
<li>通过以上方式创建的异常处理器只能处理该控制器类内部的异常，若需要统一配置可以捕获所有控制器类抛出的异常，可以新建一个异常处理器类，在类的声明处用@ControllerAdvice注解标记即可。如果在当前 控制器类 中找不到 @ExceptionHandler 方法来处理当前方法出现的异常, 则将去 @ControllerAdvice 标记的类中查找 @ExceptionHandler 标记的方法来处理异常。例如，我们现在创建一个异常处理器类，并在其中定义一个可以处理数学异常的方法：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ControllerAdvice</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMVCTestExceptionHandler</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ERROR = <span class="string">"error"</span>;</div><div class="line">	</div><div class="line">	<span class="meta">@ExceptionHandler</span>(value=ArithmeticException.class)</div><div class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleArithmeticException1</span><span class="params">(Exception ex)</span></span>&#123;</div><div class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(ERROR);</div><div class="line">		System.out.println(<span class="string">"[出异常了]："</span>+ex);</div><div class="line">		mv.addObject(<span class="string">"exception"</span>,ex);</div><div class="line">		<span class="keyword">return</span> mv;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>注释掉之前定义的handleArithmeticException方法，运行程序，与之前的例子类似，仍然跳转到error.jsp，但是在控制台输出：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/x4ypffz9mmoz7jzzmtjjxiro/image_1b1hdanpd1bqcb3sdc215gporm1g.png" alt="image_1b1hdanpd1bqcb3sdc215gporm1g.png-26.6kB"></p>
<p>表示执行的是我们新定义的handleArithmeticException1方法，注意，如果不注释掉handleArithmeticException方法，那么会优先执行handleArithmeticException方法，因为handleArithmeticException方法和抛出异常的testExceptionHandlerExceptionResolver方法定义在同一个控制器类中，testExceptionHandlerExceptionResolver方法抛出异常后会先在当前 控制器类 中找 @ExceptionHandler方法来处理当前方法出现的异常,如果找不到，才会去 @ControllerAdvice 标记的类中查找 @ExceptionHandler 标记的方法来处理异常。</p>
<h2 id="ResponseStatusExceptionResolver"><a href="#ResponseStatusExceptionResolver" class="headerlink" title="ResponseStatusExceptionResolver"></a>ResponseStatusExceptionResolver</h2><p>　　ResponseStatusExceptionResolver的作用是在异常及异常父类中找到@ResponseStatus注解，然后使用这个注解的属性进行处理。下面举例说明：</p>
<hr>
<p>页面<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;a href="testResponseStatusExceptionResolver?i=13"&gt;</div><div class="line">Test ResponseStatusExceptionResolver&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<hr>
<p>定义一个异常类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ResponseStatus</span>(value=HttpStatus.FORBIDDEN,reason=<span class="string">"用户名和密码不匹配"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNameNotMatchPasswordException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * </div><div class="line">	 */</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>模拟一个可以抛出上述异常的方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//定义一个可以抛出UserNameNotMatchPasswordException异常的方法</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testResponseStatusExceptionResolver"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testResponseStatusExceptionResolver</span><span class="params">(@RequestParam(<span class="string">"i"</span>)</span> <span class="keyword">int</span> i) </span>&#123;</div><div class="line">	<span class="keyword">if</span>(i==<span class="number">13</span>)</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UserNameNotMatchPasswordException();</div><div class="line">	<span class="keyword">return</span> SUCCESS;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>运行程序，由于抛出了异常，并且我们没有定义任何异常处理器对该异常进行处理，那么会出现我们定制的异常页面：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/v31hiu7t9r566r3893tyhl90/image_1b1hfd8r917su1p7i1viie55ac1t.png" alt="image_1b1hfd8r917su1p7i1viie55ac1t.png-28.8kB"></p>
<p>此外，@ResponseStatus注解还可以用来标记方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ResponseStatus</span>(reason=<span class="string">"测试"</span>,value=HttpStatus.NOT_FOUND) </div><div class="line">		<span class="meta">@RequestMapping</span>(<span class="string">"/testResponseStatusExceptionResolver"</span>)</div><div class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">testResponseStatusExceptionResolver</span><span class="params">(@RequestParam(<span class="string">"i"</span>)</span> <span class="keyword">int</span> i) </span>&#123;</div><div class="line">			<span class="keyword">if</span>(i==<span class="number">13</span>)</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> UserNameNotMatchPasswordException();</div><div class="line">			System.out.println(<span class="string">"testResponseStatusExceptionResolver..."</span>);</div><div class="line">			<span class="keyword">return</span> SUCCESS;</div><div class="line">		&#125;</div></pre></td></tr></table></figure></p>
<p>现在，我们在浏览器中令i=10，这样方法是不会抛出UserNameNotMatchPasswordException异常的，结果程序跳转到了如下页面：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/ua782sezjdtrh0eryojen0kq/image_1b1hg7ludgi3dqeadvea917mq2a.png" alt="image_1b1hg7ludgi3dqeadvea917mq2a.png-23.5kB"></p>
<p>但是控制台上输出了如下信息，说明这个方法被正常地执行了：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/kdjejuwwsqazp2i0q2peh453/image_1b1hg8ssm5goidn1f5m1rjqjm42n.png" alt="image_1b1hg8ssm5goidn1f5m1rjqjm42n.png-27.9kB"></p>
<h2 id="DefaultHandlerExceptionResolver"><a href="#DefaultHandlerExceptionResolver" class="headerlink" title="DefaultHandlerExceptionResolver"></a>DefaultHandlerExceptionResolver</h2><p>　　对一些特殊的异常进行处理，比如NoSuchRequestHandlingMethodException、HttpRequestMethodNotSupportedException等，具体处理哪些异常可以在DefaultHandlerExceptionResolver源码中查看doResolveException()方法。</p>
<h2 id="SimpleMappingExceptionResolver"><a href="#SimpleMappingExceptionResolver" class="headerlink" title="SimpleMappingExceptionResolver"></a>SimpleMappingExceptionResolver</h2><p>　　SimpleMappingExceptionResolver可以将异常类名映射为视图名，即发生异常时使用对应的视图报告异常。下面进行测试：</p>
<hr>
<p>页面</p>
<p>index.jsp<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;a href="testSimpleMappingExceptionResolver?i=21"&gt;</div><div class="line">Test SimpleMappingExceptionResolver&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>error.jsp<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;h4&gt;Error Page&lt;/h4&gt;</div><div class="line">$&#123;exception &#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>控制器<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义一个可以抛出ArrayIndexOutOfBoundsException异常的方法</span></div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testSimpleMappingExceptionResolver"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testSimpleMappingExceptionResolver</span><span class="params">(@RequestParam(<span class="string">"i"</span>)</span> <span class="keyword">int</span> i) </span>&#123;</div><div class="line">		<span class="keyword">int</span>[] values = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">20</span>];</div><div class="line">		System.out.println(values[i]);</div><div class="line">		<span class="keyword">return</span> SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>spring配置文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置使用 SimpleMappingExceptionResolver 来映射异常 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionMappings"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">props</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"java.lang.ArrayIndexOutOfBoundsException"</span>&gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">props</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<hr>
<p>运行程序：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/d9zmg6mz82n1z8xt2x8qlgqj/image_1b1hi0jq9bnd76gji918aa1pe234.png" alt="image_1b1hi0jq9bnd76gji918aa1pe234.png-14.7kB"></p>
<p>由于目标方法抛出了数组下标越界异常，程序跳转到了error.jsp页面，并且在页面上打印了异常信息，这是因为在SimpleMappingExceptionResolver中有一个String类型的属性exceptionAttribute，其默认值为exception，所以我们在error.jsp中通过${exception }可以获取到。也可以在配置文件中配置exceptionAttribute的值，例如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置使用 SimpleMappingExceptionResolver 来映射异常 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionAttribute"</span> <span class="attr">value</span>=<span class="string">"ex"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionMappings"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">props</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"java.lang.ArrayIndexOutOfBoundsException"</span>&gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">props</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>那么，此时需要在error.jsp中通过如下方式在可以获取到异常信息：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;h4&gt;Error Page&lt;/h4&gt;</div><div class="line">$&#123;ex &#125;</div></pre></td></tr></table></figure></p>
<p>　　
　　</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/14/深入理解SpringMVC中的拦截器/" itemprop="url">
                  深入理解SpringMVC中的拦截器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-14T09:22:52+08:00" content="2016-11-14">
              2016-11-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/14/深入理解SpringMVC中的拦截器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/14/深入理解SpringMVC中的拦截器/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　Spring MVC也可以使用拦截器对请求进行拦截处理。</p>
<h2 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h2><p>　　用户可以通过实现HandlerInterceptor接口，使用自定义的拦截器。<br>　　下面展示如何配置自定义的拦截器：</p>
<hr>
<p>创建拦截器类FirstInterceptor<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 该方法在目标方法之前被调用.</div><div class="line">	 * 若返回值为 true, 则继续调用后续的拦截器和目标方法. </div><div class="line">	 * 若返回值为 false, 则不会再调用后续的拦截器和目标方法. </div><div class="line">	 * </div><div class="line">	 * 可以考虑做权限. 日志, 事务等. </div><div class="line">	 */</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></div><div class="line">			<span class="keyword">throws</span> Exception &#123;</div><div class="line">		System.out.println(<span class="string">"[FirstInterceptor] preHandle"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 调用目标方法之后, 但渲染视图之前. </div><div class="line">	 * 可以对请求域中的属性或视图做出修改. </div><div class="line">	 */</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></div><div class="line">			ModelAndView modelAndView) <span class="keyword">throws</span> Exception &#123;</div><div class="line">		System.out.println(<span class="string">"[FirstInterceptor] postHandle"</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 渲染视图之后被调用. 释放资源</div><div class="line">	 */</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span></div><div class="line">			<span class="keyword">throws</span> Exception &#123;</div><div class="line">		System.out.println(<span class="string">"[FirstInterceptor] afterCompletion"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>springmvc配置文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置自定义的拦截器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.MySpringMVC.interceptors.FirstInterceptor"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></div></pre></td></tr></table></figure></p>
<hr>
<p>现在只要有任何页面提交请求，拦截器就会工作：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/srb2jjxz79y2tqj8zssylm6w/image_1b1g8etan1egn13fj18ss70l1v089.png" alt="image_1b1g8etan1egn13fj18ss70l1v089.png-15.9kB"></p>
<p>注意：即使页面请求的是不通过控制器，而是通过配置&lt;mvc:view-controller&gt;直接跳转到页面，拦截器也会捕获到请求。</p>
<p>可以通过在&lt;mvc:interceptors&gt;用&lt;mvc:interceptor&gt;配置拦截器，从而指定拦截器对哪些请求起作用，对哪些请求不起作用，例如，我们现在定义另一个拦截器类SecondInterceptor：</p>
<hr>
<p>springmvc配置文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置自定义的拦截器 FirstInterceptor --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.MySpringMVC.interceptors.FirstInterceptor"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 配置自定义的拦截器 SecondInterceptor --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 配置拦截器作用的路径 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/emps"</span> /&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 若要配置不起作用的路径，则使用 &lt;mvc:exclude-mapping path=""/&gt; --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.MySpringMVC.interceptors.SecondInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></div></pre></td></tr></table></figure></p>
<hr>
<p>创建拦截器类 SecondInterceptor<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</div><div class="line"></div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 该方法在目标方法之前被调用.</div><div class="line">	 * 若返回值为 true, 则继续调用后续的拦截器和目标方法. </div><div class="line">	 * 若返回值为 false, 则不会再调用后续的拦截器和目标方法. </div><div class="line">	 * </div><div class="line">	 * 可以考虑做权限. 日志, 事务等. </div><div class="line">	 */</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></div><div class="line">			<span class="keyword">throws</span> Exception &#123;</div><div class="line">		System.out.println(<span class="string">"[SecondInterceptor] preHandle"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 调用目标方法之后, 但渲染视图之前. </div><div class="line">	 * 可以对请求域中的属性或视图做出修改. </div><div class="line">	 */</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></div><div class="line">			ModelAndView modelAndView) <span class="keyword">throws</span> Exception &#123;</div><div class="line">		System.out.println(<span class="string">"[SecondInterceptor] postHandle"</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 渲染视图之后被调用. 释放资源</div><div class="line">	 */</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span></div><div class="line">			<span class="keyword">throws</span> Exception &#123;</div><div class="line">		System.out.println(<span class="string">"[SecondInterceptor] afterCompletion"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>现在，如果我们在页面上请求访问的路径为emps，那么两个拦截器FirstInterceptor和SecondInterceptor都会起作用，如果请求访问emps路径以外的路径，那么只有FirstInterceptor拦截器会起作用。</p>
<h2 id="拦截器方法及其执行顺序"><a href="#拦截器方法及其执行顺序" class="headerlink" title="拦截器方法及其执行顺序"></a>拦截器方法及其执行顺序</h2><p><strong>1、单个拦截器各方法的执行顺序</strong></p>
<p>　　HandlerInterceptor接口定义了三个方法：</p>
<ul>
<li><strong>preHandle()：</strong>这个方法在业务处理器<strong>处理请求之前</strong>被调用，在该方法中对用户请求request 进行处理。如果程序员决定该拦截器对请求进行拦截处理后还要调用其他的拦截器，或者是业务处理器去进行处理，则返回true；如果程序员决定不需要再调用其他的组件去处理请求，则返回false。</li>
<li><strong>postHandle()：</strong>这个方法在业务处理器<strong>处理完请求后</strong>，但是DispatcherServlet <strong>向客户端返回响应前</strong>被调用，在该方法中对用户请求request进行处理。</li>
<li><strong>afterCompletion()：</strong>这个方法在DispatcherServlet <strong>完全处理完请求后</strong>被调用，可以在该方法中进行一些资源清理的操作。</li>
</ul>
<p>　　例如FirstInterceptor拦截器各方法的执行顺序为：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/f742jchbnbw9du6hliou2ffa/image_1b1gadk6fun63kl8um1rfn1kvsm.png" alt="image_1b1gadk6fun63kl8um1rfn1kvsm.png-51.1kB"></p>
<p><strong>2、多个拦截器之间各方法的执行顺序</strong></p>
<p>　　当有多个拦截器同时工作时，则它们的preHandle()方法按照拦截器的配置的顺序执行，它们的postHandle()方法和afterCompletion()方法按照配置顺序的反序执行。例如我们在上面的springmvc配置文件中，先配置了FirstInterceptor，后配置了SecondInterceptor，那么当请求两个拦截器都起作用的emps路径时，拦截器的执行顺序为：<br>　　<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/e990dkehsvp2lwcy5egyzjvm/image_1b1garmstfhptsineq44h1ngv13.png" alt="image_1b1garmstfhptsineq44h1ngv13.png-20.5kB"></p>
<p>即：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/6qqvohk9tk1ku8t21thjtk87/image_1b1gbv3be1vjd134g2uveju16b71p.png" alt="image_1b1gbv3be1vjd134g2uveju16b71p.png-65.4kB"></p>
<p>如果当SecondInterceptor的preHandle方法返回false时，程序会怎样执行呢？<br>我们令SecondInterceptor的preHandle方法返回false，运行程序：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/xzd71nb6ybazwc2xt704ru8y/image_1b1gfcuvh2rbocd1gh7u06qvt26.png" alt="image_1b1gfcuvh2rbocd1gh7u06qvt26.png-30.6kB"></p>
<p>即SecondInterceptor的preHandle方法返回false后，仅执行了FirstInterceptor的afterCompletion()方法，查看Spring的源码，我了解到了其工作流程是这样的：</p>
<p>1、当页面发送请求后，DispatcherServlet会通过其中的HandlerExecutionChain对象依次调用各拦截器的的preHandle()方法；<br>2、查看该HandlerExecutionChain对象，发现其中的interceptors属性记录了当前项目配置的所有拦截器：<br><img src="http://static.zybuluo.com/xiangwanpeng/wwh0i7l603w1yfss07uud6b5/image_1b1gg7ussuub1qfnukt9221ggo2j.png" alt="image_1b1gg7ussuub1qfnukt9221ggo2j.png-8.6kB"><br>其中除了我们自定义的两个拦截器以外，还有一个SpringMVC内置的ConversionServiceExposingInterceptor拦截器。此外，还有一个int型参数interceptorIndex用于记录当前时刻 preHandle()方法已经返回true的拦截器的最大下标，例如现在我们的SecondInterceptor拦截器的preHandle()方法返回了false，那么interceptorIndex参数便为1，代表拦截器ConversionServiceExposingInterceptor和FirstInterceptor的preHandle()方法返回了true：<br><img src="http://static.zybuluo.com/xiangwanpeng/gs3d2cjky0wwgvigez8aj5uk/image_1b1ggq9g91e2kgkjhie16ulhmt3d.png" alt="image_1b1ggq9g91e2kgkjhie16ulhmt3d.png-9.8kB"><br>3、当HandlerExecutionChain对象发现SecondInterceptor拦截器的preHandle()方法返回了false后，便执行triggerAfterCompletion()方法用于从下标值为interceptorIndex开始执行各拦截器的afterCompletion()方法，直到下标值减为-1为止：<br><img src="http://static.zybuluo.com/xiangwanpeng/6rq46em8sw6e91a4vxs8g81y/image_1b1ggn7saenb1hiq1pn01s9u8km30.png" alt="image_1b1ggn7saenb1hiq1pn01s9u8km30.png-13kB"></p>
<p>那么，我们就很好理解了为什么当SecondInterceptor拦截器的preHandle()方法返回了false后，程序运行结果为上述截图的那样了，运行流程如下：<br><img src="http://static.zybuluo.com/xiangwanpeng/eyw48xxfcgiwzn4kqklhj1yv/image_1b1ggvjvfse5ce1hhqn8a1ict3q.png" alt="image_1b1ggvjvfse5ce1hhqn8a1ict3q.png-154.2kB"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/14/SpringMVC的文件上传功能/" itemprop="url">
                  SpringMVC的文件上传功能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-14T09:02:09+08:00" content="2016-11-14">
              2016-11-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/14/SpringMVC的文件上传功能/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/14/SpringMVC的文件上传功能/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　spring MVC为文件上传提供了直接的支持，这种支持是通过即插即用的<strong>MultipartResolver（接口）</strong>实现的。Spring 用Jakarta Commons FileUpload技术实现了一个MultipartResolver实现类：<strong>CommonsMultipartResovler</strong>。<br>　　Spring MVC 上下文中<strong>默认没有装配MultipartResovler</strong>，因此默认情况下不能处理文件的上传工作，如果想使用Spring 的文件上传功能，需先在上下文中配置MultipartResolver。<br>　　下面展示如何配置CommonsMultipartResovler，以及如何使用上传文件功能：<br>　　<br>　　<br>导入jar包：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/8u6jr9gu2ns8pvhmzva866gp/image_1b1g674tqj56o151iba18fu137r9.png" alt="image_1b1g674tqj56o151iba18fu137r9.png-4.4kB"><br>配置CommonsMultipartResovler:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</div><div class="line">		<span class="comment">&lt;!-- defaultEncoding: 必须和用户JSP 的pageEncoding属性一致，以便正确解析表单的内容 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 指定上传的文件最大不能超过1000KB --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInMemorySize"</span> <span class="attr">value</span>=<span class="string">"1024000"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 还可以指定其他属性... --&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>上传示例：</p>
<hr>
<p>index.jsp<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;form action="testUpload" method="post" enctype="multipart/form-data"&gt;</div><div class="line">		File:&lt;input type="file" name="file" /&gt; </div><div class="line">		Description:&lt;input type="text" name="des" /&gt; </div><div class="line">		&lt;input type="submit" value="Upload" /&gt;</div><div class="line">	&lt;/form&gt;</div></pre></td></tr></table></figure></p>
<hr>
<p>controller<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testUpload"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testUpload</span><span class="params">(@RequestParam(<span class="string">"file"</span>)</span> MultipartFile file, @<span class="title">RequestParam</span><span class="params">(<span class="string">"des"</span>)</span> String des)</span></div><div class="line">			<span class="keyword">throws</span> IllegalStateException, IOException &#123;</div><div class="line">		<span class="keyword">if</span> (!file.isEmpty()) &#123;</div><div class="line">			System.out.println(<span class="string">"des : "</span> + des);</div><div class="line">			file.transferTo(<span class="keyword">new</span> File(<span class="string">"G:/UploadTest/"</span> + file.getOriginalFilename()));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>运行程序：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/oxa7590t74g67yww9kuvg5l1/image_1b1g6gesri3q1dsp50svkapq2m.png" alt="image_1b1g6gesri3q1dsp50svkapq2m.png-11.4kB"></p>
<p>在index.jsp选择一个文本文件test.txt，文本中输入MY TEXT,点击Upload：</p>
<p>控制台输出：<br><img src="http://static.zybuluo.com/xiangwanpeng/0ee87ic4w5n2n84oli89tdro/image_1b1g6j1e71b9tiaepd1fs0142c13.png" alt="image_1b1g6j1e71b9tiaepd1fs0142c13.png-2.7kB"></p>
<p>且 G:/UploadTest/ 目录下获取到了该文件：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/r5vntfjkiv5y1a1jejrnxn2l/image_1b1g6k63212tci7e145h19gu1f5h1g.png" alt="image_1b1g6k63212tci7e145h19gu1f5h1g.png-10.3kB"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/13/关于SpringMVC中的国际化/" itemprop="url">
                  关于SpringMVC中的国际化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-13T19:05:57+08:00" content="2016-11-13">
              2016-11-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/13/关于SpringMVC中的国际化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/13/关于SpringMVC中的国际化/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="国际化概述"><a href="#国际化概述" class="headerlink" title="国际化概述"></a>国际化概述</h2><p>　　为了让Web项目支持国际化，需要识别每个用户的首选区域，并根据这个区域显示内容。在spring MVC应用程序中，用户的区域是通过区域解析器来识别的，它必须实现LocaleResolver接口。<br>　　Spring MVC提供了几个LocaleResolver的实现，我们可以根据不同的需求来解析区域。如果SpringMVC提供的解析器不能满足需求，我们可以实现LocaleResolver接口，创建自定义的区域解析器。<br>　　要定义一个区域解析器，只需在web应用程序上下文中注册一个LocaleResolver类型的Bean就可以了。必须将区域解析器的Bean名称设置为localeResolver，这样DispatcherServlet才能自动侦测到它。注意，每DispatcherServlet只能注册一个区域解析器。<br>　　<br>　　Spring采用的默认区域解析器是AcceptHeaderLocaleResolver。它通过检验HTTP请求头的accept-language属性来解析区域。
　　</p>
<h2 id="默认区域解析器AcceptHeaderLocaleResolver的示例"><a href="#默认区域解析器AcceptHeaderLocaleResolver的示例" class="headerlink" title="默认区域解析器AcceptHeaderLocaleResolver的示例"></a>默认区域解析器AcceptHeaderLocaleResolver的示例</h2><p>　　下面通过两个例子展示默认的区域解析器AcceptHeaderLocaleResolver的效果：<br>　　<br>　　<strong>示例一：在页面上能够根据浏览器语言设置的情况对文本(不是内容), 时间, 数值进行本地化处理。</strong><br>　　<br>　　要实现上述功能，使用 JSTL 的 fmt 标签即可。（假设请求不经过控制器，直接跳转到jsp页面）</p>
<hr>
<p><strong>创建国际化资源文件</strong></p>
<p>i18n_zh_CN.properties：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">i18n.username=\u7528\u6237\u540D</div><div class="line">i18n.password=\u5BC6\u7801</div></pre></td></tr></table></figure></p>
<p>注：\u7528\u6237\u540D为“用户名”，\u5BC6\u7801为“密码”</p>
<p>i18n_en_US.properties：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">i18n.username=username</div><div class="line">i18n.password=password</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>配置国际化资源文件</strong></p>
<p>spring配置文件:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置国际化资源文件 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSource"</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.context.support.ResourceBundleMessageSource"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basename"</span> <span class="attr">value</span>=<span class="string">"i18n"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	</div><div class="line"><span class="comment">&lt;!--同时配置jsp页面的直接跳转--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/i18n"</span> <span class="attr">view-name</span>=<span class="string">"i18n"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/i18n2"</span> <span class="attr">view-name</span>=<span class="string">"i18n2"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<hr>
<p><strong>页面</strong></p>
<p>i18n.jsp:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"</div><div class="line">	pageEncoding="UTF-8"%&gt;</div><div class="line">&lt;%@taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">	&lt;fmt:message key="i18n.username"&gt;&lt;/fmt:message&gt;</div><div class="line">	&lt;br&gt;&lt;br&gt;</div><div class="line">	&lt;a href="i18n2"&gt;I18N2 Page&lt;/a&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>i18n2.jsp:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"</div><div class="line">	pageEncoding="UTF-8"%&gt;</div><div class="line">&lt;%@taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;fmt:message key="i18n.password"&gt;&lt;/fmt:message&gt;</div><div class="line">	&lt;br&gt;&lt;br&gt;</div><div class="line">	&lt;a href="i18n"&gt;I18N Page&lt;/a&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>运行结果：</strong><br>　　当设置浏览器语言为zh-cn时，i18n.jsp显示“用户名”，i18n2.jsp显示“密码”；<br>　　当设置浏览器语言为en-us时，i18n.jsp显示“username”，i18n2.jsp显示“password”。</p>
<hr>
<p>　　<strong>示例二：在 bean 中获取国际化资源文件 对应于 Locale 的信息。</strong><br>　　<br>　　要实现上述功能，在 bean 中注入 ResourceBundleMessageSource 的实例, 使用其对应的 getMessage 方法即可：（创建国际化资源文件、配置国际化资源文件同示例一，但是令/i18n映射到控制器，而非直接跳转）</p>
<hr>
<p><strong>页面</strong></p>
<p>index.jsp：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href="i18n"&gt;I18N Page&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>控制器：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> ResourceBundleMessageSource messageSource;</div><div class="line">	</div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/i18n"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testI18N</span><span class="params">(Locale locale)</span> </span>&#123;</div><div class="line">		String val = messageSource.getMessage(<span class="string">"i18n.username"</span>, <span class="keyword">null</span>, locale);</div><div class="line">		System.out.println(val);</div><div class="line">		<span class="keyword">return</span> <span class="string">"i18n"</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>运行结果：</strong><br>　　当设置浏览器语言为zh-cn时，点击index.jsp中的超链接，控制台输出“用户名”；<br>　　当设置浏览器语言为en-us时，点击index.jsp中的超链接，控制台输出“username”。</p>
<h2 id="使用SessionLocaleResolver实现通过超链接切换-Locale"><a href="#使用SessionLocaleResolver实现通过超链接切换-Locale" class="headerlink" title="使用SessionLocaleResolver实现通过超链接切换 Locale"></a>使用SessionLocaleResolver实现通过超链接切换 Locale</h2><p>　　<strong>示例三：现在我们希望可以通过超链接切换 Locale, 而不再依赖于浏览器的语言设置情况</strong><br>　　<br>　　实现方法为配置 SessionLocalResolver 和 LocaleChangeInterceptor。（创建、配置国际化资源文件同上面的例子）</p>
<hr>
<p><strong>配置SessionLocaleResolver和LocaleChangeInterceptor</strong></p>
<p>spring配置文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置 LocaleChanceInterceptor 拦截器 </span></div><div class="line">		     作用： 获取name=locale的请求参数 --&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置 SessionLocalResolver</span></div><div class="line">     作用：将Locale对象设置为session的属性；从session中获取Locale对象 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"localeResolver"</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.i18n.SessionLocaleResolver"</span>&gt;<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<hr>
<p><strong>页面：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;a href="i18n?locale=zh_CN"&gt;Chinese&lt;/a&gt;</div><div class="line">	&lt;br&gt;&lt;br&gt;</div><div class="line">	&lt;a href="i18n?locale=en_US"&gt;English&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>控制器：</strong> (同示例二)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> ResourceBundleMessageSource messageSource;</div><div class="line">	</div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/i18n"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testI18N</span><span class="params">(Locale locale)</span> </span>&#123;</div><div class="line">		String val = messageSource.getMessage(<span class="string">"i18n.username"</span>, <span class="keyword">null</span>, locale);</div><div class="line">		System.out.println(val);</div><div class="line">		<span class="keyword">return</span> <span class="string">"i18n"</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>运行结果：</strong><br>　　当点击页面的Chinese时，控制台输出“用户名”；<br>　　当点击页面的English时，控制台输出“username”。
　　</p>
<h2 id="SessionLocaleResolver-amp-LocaleChangeInterceptor的工作原理"><a href="#SessionLocaleResolver-amp-LocaleChangeInterceptor的工作原理" class="headerlink" title="SessionLocaleResolver&amp;LocaleChangeInterceptor的工作原理"></a>SessionLocaleResolver&amp;LocaleChangeInterceptor的工作原理</h2><p>　　通过查看源码，我了解到利用SessionLocaleResolver和LocaleChangeInterceptor实现示例三功能的工作流程为：</p>
<ol>
<li>在目标方法执行之前，LocaleChangeInterceptor拦截器的preHandle方法会先被调用，该方法获取请求参数中的locale属性，如果locale不为空，则获取到当前的区域解析器（此时为SessionLocaleResolver），然后调用SessionLocaleResolver对象的setLocale方法，其中把 根据locale值生成的Locale对象 作为参数传递到该方法中。</li>
<li>在SessionLocaleResolver对象的setLocale方法中，会将Locale对象设置到Session中。</li>
<li>DispatchServlet通过SessionLocaleResolver区域解析器在session中获取到Locale对象，将其传入目标方法，然后即可在目标方法中使用Locale对象。
　　</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/13/使用HttpMessageConverter处理JSON/" itemprop="url">
                  使用HttpMessageConverter处理JSON
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-13T13:37:41+08:00" content="2016-11-13">
              2016-11-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/13/使用HttpMessageConverter处理JSON/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/13/使用HttpMessageConverter处理JSON/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HttpMessageConverter-lt-T-gt-工作原理："><a href="#HttpMessageConverter-lt-T-gt-工作原理：" class="headerlink" title="HttpMessageConverter&lt;T&gt;工作原理："></a>HttpMessageConverter&lt;T&gt;工作原理：</h2><p>　　HttpMessageConverter&lt;T&gt; 是 Spring3.0 新添加的一个接口，负责将请求信息转换为一个对象（类型为 T）并绑定到处理方法的入参中，或将对象（类型为T）输出为响应信息。对此SpringMVC提供了两种实现途径：</p>
<ol>
<li>使用@RequestBody/@ResponseBody注解对处理方法进行标注。</li>
<li>使用HttpEntity&lt;T&gt;/ResponseEntity&lt;T&gt;作为处理方法的入参或返回值。</li>
</ol>
<p>　　当控制器处理方法使用到@RequestBody/@ResponseBody 或者 HttpEntity&lt;T&gt;/ResponseEntity&lt;T&gt;时，Spring首先根据请求头或响应头的Accept属性选择匹配的HttpMessageConverter，进而根据参数类型或泛型类型的过滤得到匹配的HttpMessageConverter，若找不到可用的HttpMessageConverter将会报错。<br>　　<br>　　下图展示了HttpMessageConverter&lt;T&gt;的工作原理：<br><img src="http://static.zybuluo.com/xiangwanpeng/6kxdu7mbpllai4yitjihlcze/image_1b1e5tcdhui21hgpn6eqo3ba01t.png" alt="image_1b1e5tcdhui21hgpn6eqo3ba01t.png-204.3kB"></p>
<p>　　DispatcherServlet默认装配了RequestMappingHandlerAdapter，我们查看Spring源码发现RequestMappingHandlerAdapter默认装配了如下的HttpMessageConverter：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/incfdoz36t2g7cit76b9flgt/image_1b1eccehf393hvg135teo0105o3u.png" alt="image_1b1eccehf393hvg135teo0105o3u.png-210.6kB"></p>
<h2 id="HttpMessageConverter-lt-T-gt-使用示例"><a href="#HttpMessageConverter-lt-T-gt-使用示例" class="headerlink" title="HttpMessageConverter&lt;T&gt;使用示例"></a>HttpMessageConverter&lt;T&gt;使用示例</h2><p>　　在开始介绍HttpMessageConverter&lt;T&gt;的用法之前，需要先导入jar包：<br>　　<br><img src="http://static.zybuluo.com/xiangwanpeng/8kfxf49wcxst9qgolmez1vgv/image_1b1e4vo451r1j1pc1qmm1sc5127n9.png" alt="image_1b1e4vo451r1j1pc1qmm1sc5127n9.png-3.9kB"></p>
<p>　　在导入以上jar包后，RequestMappingHandlerAdapter会自动额外装配一个HttpMessageConverter对象，用于在Java对象和JSON对象之间进行转换：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/cee3g4cjvn4xgiwuzuw0mkck/image_1b1ecs9khgn721bln28qrao04b.png" alt="image_1b1ecs9khgn721bln28qrao04b.png-248.1kB"><br>　　<br>　　下面的三个示例分别展示了@ResponseBody、@RequestBody和ResponseEntity&lt;T&gt;的使用方法，HttpEntity&lt;T&gt;用法类似。<br>　　<br><strong>示例一：</strong>通过@RequestBody注解将目标方法返回的Java对象转为HttpOutputMessage，并在页面中通过AJAX获取：</p>
<p>jsp：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&amp;lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></div><div class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&amp;gt;</div><div class="line">&amp;lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&amp;gt;</div><div class="line">&amp;lt;html&amp;gt;</div><div class="line">&amp;lt;head&amp;gt;</div><div class="line">&amp;lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&amp;gt;</div><div class="line">&amp;lt;title&amp;gt;index jsp&amp;lt;/title&amp;gt;</div><div class="line">&amp;lt;script type=<span class="string">"text/javascript"</span></div><div class="line">	src=<span class="string">"$&#123;pageContext.request.contextPath &#125;/scripts/jquery-1.9.1.min.js"</span>&amp;gt;&amp;lt;/script&amp;gt;</div><div class="line">&amp;lt;script type=<span class="string">"text/javascript"</span>&amp;gt;</div><div class="line">	$(function() &#123;</div><div class="line">		$(<span class="string">"#testJson"</span>).click(function() &#123;</div><div class="line">			var url = $(<span class="keyword">this</span>).attr(<span class="string">"href"</span>);</div><div class="line">			var arg = &#123;</div><div class="line">				<span class="string">"time"</span> : <span class="keyword">new</span> Date()</div><div class="line">			&#125;;</div><div class="line">			$.get(url, arg, function(data) &#123;</div><div class="line">				<span class="keyword">for</span> (var i = <span class="number">0</span>; i &amp;lt; data.length; i++)</div><div class="line">					alert(data[i].id + <span class="string">":"</span> + data[i].lastName);</div><div class="line">			&#125;);</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		&#125;);</div><div class="line">	&#125;)</div><div class="line">&amp;lt;/script&amp;gt;</div><div class="line">&amp;lt;/head&amp;gt;</div><div class="line">&amp;lt;body&amp;gt;</div><div class="line">&amp;lt;a href=<span class="string">"testJson"</span> id=<span class="string">"testJson"</span>&amp;gt;Test Json&amp;lt;/a&amp;gt;</div><div class="line">&amp;lt;/body&amp;gt;</div><div class="line">&amp;lt;/html&amp;gt;</div></pre></td></tr></table></figure></p>
<p>controller:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testJson"</span>)</div><div class="line"><span class="keyword">public</span> Collection&amp;lt;Employee&amp;gt; testJson()&#123;</div><div class="line">	<span class="keyword">return</span> employeeDao.getAll();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行后浏览器会依次弹出“data[i].id + “:” + data[i].lastName”的提示信息：<br><img src="http://static.zybuluo.com/xiangwanpeng/q7pfjn5vjnoouesjsp8uclbd/image_1b1e5htql1qbvqkm45h1br01pi4m.png" alt="image_1b1e5htql1qbvqkm45h1br01pi4m.png-8.8kB"><br><img src="http://static.zybuluo.com/xiangwanpeng/xffe7s0zlrrrgffv4ybdoh8n/image_1b1e5iuc215auou3m7164dubo13.png" alt="image_1b1e5iuc215auou3m7164dubo13.png-9.8kB"><br><img src="http://static.zybuluo.com/xiangwanpeng/vcr5c4n7voq3k7m6airegr8x/image_1b1e5j6681i2i1jtk1t71fi010mv1g.png" alt="image_1b1e5j6681i2i1jtk1t71fi010mv1g.png-10.2kB"></p>
<p>　　　　　　　　　　…<br>　　　　　　　　　　<br><strong>示例二：</strong>通过@RequestBody注解实现实现文件上传的功能：</p>
<p>jsp：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&amp;lt;form action=<span class="string">"testRequestBody"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&amp;gt;</div><div class="line">	File：&amp;lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span> /&amp;gt;</div><div class="line">	Description：&amp;lt;input type=<span class="string">"text"</span> name=<span class="string">"des"</span> /&amp;gt;</div><div class="line">	&amp;lt;input type=<span class="string">"submit"</span> value=<span class="string">"Submit"</span> /&amp;gt;</div><div class="line">	&amp;lt;/form&amp;gt;</div></pre></td></tr></table></figure></p>
<p>controller:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testRequestBody"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRequestBody</span><span class="params">(@RequestBody String body)</span></span>&#123;</div><div class="line">	System.out.println(body);</div><div class="line">	</div><div class="line">	<span class="comment">//return "helloworld!"+new Date()保证了方法执行完后不会匹配任何一个页面</span></div><div class="line">	<span class="keyword">return</span> <span class="string">"helloworld!"</span>+<span class="keyword">new</span> Date();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行程序，我们上传一个test.txt文件，其中存储了某一jsp页面的信息，并在Description中输入文本值“MY TEXT”：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/2tzf2ba9irb80w5c80gatybh/image_1b1eatgr614ev90sl1a1bvqlo134.png" alt="image_1b1eatgr614ev90sl1a1bvqlo134.png-4.4kB"></p>
<p>提交之后，HttpMessageConverter会把上传的文件和文本值转换为一个String类型的对象，并在控制台输出：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/59nytp085y0llz3ef2gcficl/image_1b1ea9rkce0gv63gt42mbdum2a.png" alt="image_1b1ea9rkce0gv63gt42mbdum2a.png-51.8kB"></p>
<p>而且浏览器上也显示了helloworld！+时间：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/71tjknc0eriwr95o5lp7ehfy/image_1b1eab44h162210eaalel771c802n.png" alt="image_1b1eab44h162210eaalel771c802n.png-11.8kB"></p>
<p>  注意，如果在spring的配置文件中注册了CommonsMultipartResolver类型的bean实例，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&amp;lt;bean id="multipartResolver"</div><div class="line">		class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&amp;gt;</div><div class="line">	&amp;lt;/bean&amp;gt;</div></pre></td></tr></table></figure></p>
<p>那么@RequestBody就不能正常将上传的文件类型转换为String类型在控制台输出了，原因暂时我还不太清楚。</p>
<p><strong>示例三：通过@ResponseEntity&lt;T&gt;实现文件下载的功能：</strong></p>
<p>jsp：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&amp;lt;a href=<span class="string">"testResponseEntity"</span>&amp;gt;Test ResponseEntity&amp;lt;/a&amp;gt;</div></pre></td></tr></table></figure></p>
<p>在根目录下的file目录下保存了示例二中的test.txt：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/lnlqsleholcndisptu7f7dql/image_1b1ec0e011pq61o0v1nipd41j6f3h.png" alt="image_1b1ec0e011pq61o0v1nipd41j6f3h.png-3.2kB"></p>
<p>controller:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ResponseBody</span></div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testResponseEntity"</span>)</div><div class="line">	<span class="keyword">public</span> ResponseEntity&amp;lt;<span class="keyword">byte</span>[]&amp;gt; testResponseEntity(HttpSession session) <span class="keyword">throws</span> IOException&#123;</div><div class="line">		<span class="keyword">byte</span>[] body = <span class="keyword">null</span>;</div><div class="line">		ServletContext context = session.getServletContext();</div><div class="line">		InputStream in = context.getResourceAsStream(<span class="string">"/file/test.txt"</span>);</div><div class="line">		body = <span class="keyword">new</span> <span class="keyword">byte</span>[in.available()];</div><div class="line">		in.read(body);</div><div class="line">		</div><div class="line">		HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</div><div class="line">		headers.add(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename=test.txt"</span>);</div><div class="line">		</div><div class="line">		HttpStatus statusCode = HttpStatus.OK;</div><div class="line">		</div><div class="line">		ResponseEntity&amp;lt;<span class="keyword">byte</span>[]&amp;gt; entity = <span class="keyword">new</span> ResponseEntity&amp;lt;<span class="keyword">byte</span>[]&amp;gt;(body, headers, statusCode);</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> entity;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行程序，点击超链接Test ResponseEntity后发现可以正确下载test.txt文件。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/13/使用SpringMVC实现REST风格的CRUD功能/" itemprop="url">
                  使用SpringMVC实现REST风格的CRUD功能
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-13T09:31:41+08:00" content="2016-11-13">
              2016-11-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/13/使用SpringMVC实现REST风格的CRUD功能/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/13/使用SpringMVC实现REST风格的CRUD功能/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　这篇文章介绍如何使用SpringMVC实现简单的、REST风格的员工信息的增删改查操作。<a href="https://github.com/xiangwanpeng/SpringMVC_CRUD_REST" target="_blank" rel="external">项目源码</a>附在我的github中。
　　</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>① 查看所有员工信息：（url:emps，method：GET）</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/6c7llsk0ogkj3kox0v9s2v7i/image_1b1dlbuog1jhq1u2dfi010uf153v9.png" alt="image_1b1dlbuog1jhq1u2dfi010uf153v9.png-49.9kB"></p>
<p>② 添加员工信息，添加后重定向到显示员工信息页面：（url:emp，method：POST）</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/lj21qmuybagysrnzee7iathi/image_1b1dlh5bik4316kl11kq75jqvi13.png" alt="image_1b1dlh5bik4316kl11kq75jqvi13.png-16.4kB"></p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/m69wzh1bdg2ch9yt0jdgo49i/image_1b1dlfl0q1i2l18751ts2m4c1nldm.png" alt="image_1b1dlfl0q1i2l18751ts2m4c1nldm.png-16.1kB"></p>
<p>③ 更新员工信息。LastName字段不可修改，要求能够回显表单，更新后重定向到显示员工信息页面：（url:emp/{id}，method：PUT）</p>
<p>④ 删除员工信息，删除后重定向到显示员工信息页面。（url:emp/{id}，method：DELETE）</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>Employee.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Integer id;</div><div class="line"></div><div class="line">	<span class="meta">@NotEmpty</span></div><div class="line">	<span class="keyword">private</span> String lastName;</div><div class="line"></div><div class="line">	<span class="meta">@Email</span></div><div class="line">	<span class="keyword">private</span> String email;</div><div class="line">	</div><div class="line">	<span class="comment">// 1 male, 0 female</span></div><div class="line">	<span class="keyword">private</span> Integer gender;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Department department;</div><div class="line">	</div><div class="line">	<span class="comment">//方法略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Department.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Integer id;</div><div class="line">	<span class="keyword">private</span> String departmentName;</div><div class="line">	</div><div class="line">	<span class="comment">//方法略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>EmployeeDao.java: (其中关于数据库的操作仅采用模拟方式实现)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Repository</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeDao</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Employee&gt; employees = <span class="keyword">null</span>;</div><div class="line">	</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> DepartmentDao departmentDao;</div><div class="line">	</div><div class="line">	<span class="keyword">static</span>&#123;</div><div class="line">		employees = <span class="keyword">new</span> HashMap&lt;Integer, Employee&gt;();</div><div class="line"></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			employees.put(<span class="number">1001</span>, <span class="keyword">new</span> Employee(<span class="number">1001</span>, <span class="string">"E-AA"</span>, <span class="string">"aa@163.com"</span>, <span class="number">1</span>, <span class="keyword">new</span> Department(<span class="number">101</span>, <span class="string">"D-AA"</span>),<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"1994-03-21"</span>)));</div><div class="line">			employees.put(<span class="number">1002</span>, <span class="keyword">new</span> Employee(<span class="number">1002</span>, <span class="string">"E-BB"</span>, <span class="string">"bb@163.com"</span>, <span class="number">1</span>, <span class="keyword">new</span> Department(<span class="number">102</span>, <span class="string">"D-BB"</span>),<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"1994-03-21"</span>)));</div><div class="line">			employees.put(<span class="number">1003</span>, <span class="keyword">new</span> Employee(<span class="number">1003</span>, <span class="string">"E-CC"</span>, <span class="string">"cc@163.com"</span>, <span class="number">0</span>, <span class="keyword">new</span> Department(<span class="number">103</span>, <span class="string">"D-CC"</span>),<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"1994-03-21"</span>)));</div><div class="line">			employees.put(<span class="number">1004</span>, <span class="keyword">new</span> Employee(<span class="number">1004</span>, <span class="string">"E-DD"</span>, <span class="string">"dd@163.com"</span>, <span class="number">0</span>, <span class="keyword">new</span> Department(<span class="number">104</span>, <span class="string">"D-DD"</span>),<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"1994-03-21"</span>)));</div><div class="line">			employees.put(<span class="number">1005</span>, <span class="keyword">new</span> Employee(<span class="number">1005</span>, <span class="string">"E-EE"</span>, <span class="string">"ee@163.com"</span>, <span class="number">1</span>, <span class="keyword">new</span> Department(<span class="number">105</span>, <span class="string">"D-EE"</span>),<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"1994-03-21"</span>)));</div><div class="line">		&#125; <span class="keyword">catch</span> (ParseException e) &#123;</div><div class="line">			<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Integer initId = <span class="number">1006</span>;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Employee employee)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(employee.getId() == <span class="keyword">null</span>)&#123;</div><div class="line">			employee.setId(initId++);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		employee.setDepartment(departmentDao.getDepartment(employee.getDepartment().getId()));</div><div class="line">		employees.put(employee.getId(), employee);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Collection&lt;Employee&gt; <span class="title">getAll</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> employees.values();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Employee <span class="title">get</span><span class="params">(Integer id)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> employees.get(id);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span></span>&#123;</div><div class="line">		employees.remove(id);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>DepartmentDao.java: (其中关于数据库的操作仅采用模拟方式实现)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Repository</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepartmentDao</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Department&gt; departments = <span class="keyword">null</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">static</span>&#123;</div><div class="line">		departments = <span class="keyword">new</span> HashMap&lt;Integer, Department&gt;();</div><div class="line">		</div><div class="line">		departments.put(<span class="number">101</span>, <span class="keyword">new</span> Department(<span class="number">101</span>, <span class="string">"D-AA"</span>));</div><div class="line">		departments.put(<span class="number">102</span>, <span class="keyword">new</span> Department(<span class="number">102</span>, <span class="string">"D-BB"</span>));</div><div class="line">		departments.put(<span class="number">103</span>, <span class="keyword">new</span> Department(<span class="number">103</span>, <span class="string">"D-CC"</span>));</div><div class="line">		departments.put(<span class="number">104</span>, <span class="keyword">new</span> Department(<span class="number">104</span>, <span class="string">"D-DD"</span>));</div><div class="line">		departments.put(<span class="number">105</span>, <span class="keyword">new</span> Department(<span class="number">105</span>, <span class="string">"D-EE"</span>));</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Collection&lt;Department&gt; <span class="title">getDepartments</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> departments.values();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Department <span class="title">getDepartment</span><span class="params">(Integer id)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> departments.get(id);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>控制器EmployeeHandler.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeHandler</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> EmployeeDao employeeDao;</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> DepartmentDao departmenDao;</div><div class="line"></div><div class="line">	<span class="meta">@ModelAttribute</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEmployee</span><span class="params">(@RequestParam(value = <span class="string">"id"</span>, required = <span class="keyword">false</span>)</span> Integer id, Map&lt;String, Object&gt; map) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (id != <span class="keyword">null</span>)</div><div class="line">			map.put(<span class="string">"employee"</span>, employeeDao.get(id));</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"></div><div class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/emp/&#123;id&#125;"</span>, method = RequestMethod.DELETE)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</div><div class="line">		employeeDao.delete(id);</div><div class="line">		<span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/emp"</span>, method = RequestMethod.PUT)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(Employee employee)</span> </span>&#123;</div><div class="line">		employeeDao.save(employee);</div><div class="line">		<span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/emp"</span>, method = RequestMethod.POST)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">(@Valid Employee employee, BindingResult result, Map&lt;String, Object&gt; map)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (result.getErrorCount() &gt; <span class="number">0</span>) &#123;</div><div class="line">			System.out.println(<span class="string">"出错了！"</span>);</div><div class="line">			<span class="keyword">for</span> (FieldError error : result.getFieldErrors()) &#123;</div><div class="line">				System.out.println(error.getField() + <span class="string">":"</span> + error.getDefaultMessage());</div><div class="line">			&#125;</div><div class="line">			map.put(<span class="string">"departments"</span>, departmenDao.getDepartments());</div><div class="line">			<span class="keyword">return</span> <span class="string">"input"</span>;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		employeeDao.save(employee);</div><div class="line">		<span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/emp"</span>, method = RequestMethod.GET)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">input</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</div><div class="line">		map.put(<span class="string">"departments"</span>, departmenDao.getDepartments());</div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 在input.jsp中使用了SpringMVC的form标签，SpringMVC认为 表单是一定要进行回显的，即便是“第一次来”，</div><div class="line">		 * 所以要new一个 Employee对象放入request域 。</div><div class="line">		 */</div><div class="line">		map.put(<span class="string">"employee"</span>, <span class="keyword">new</span> Employee());</div><div class="line">		<span class="keyword">return</span> <span class="string">"input"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/emp/&#123;id&#125;"</span>, method = RequestMethod.GET)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">input</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id, Map&lt;String, Object&gt; map) </span>&#123;</div><div class="line">		map.put(<span class="string">"departments"</span>, departmenDao.getDepartments());</div><div class="line">		<span class="comment">/*</span></div><div class="line">		 * 在input.jsp中使用了SpringMVC的form标签，SpringMVC认为</div><div class="line">		 * 表单是一定要进行回显的，即便是“第一次来”，所以要获取一个 Employee对象放入request域 。</div><div class="line">		 */</div><div class="line">		map.put(<span class="string">"employee"</span>, employeeDao.get(id));</div><div class="line">		<span class="keyword">return</span> <span class="string">"input"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/emps"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</div><div class="line">		map.put(<span class="string">"employees"</span>, employeeDao.getAll());</div><div class="line">		<span class="keyword">return</span> <span class="string">"list"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>index.jsp:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"</div><div class="line">	pageEncoding="UTF-8"%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</div><div class="line">&lt;title&gt;index jsp&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">	&lt;a href="$&#123;pageContext.request.contextPath &#125;/emps"&gt;List All</div><div class="line">		Employees&lt;/a&gt;</div><div class="line">        &lt;br&gt;&lt;br&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>WEB-INF/views/input.jsp:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">&lt;%@page import="java.util.HashMap"%&gt;</div><div class="line">&lt;%@page import="java.util.Map"%&gt;</div><div class="line">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"</div><div class="line">	pageEncoding="UTF-8"%&gt;</div><div class="line">&lt;%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;</div><div class="line">&lt;%@taglib prefix="form" uri="http://www.springframework.org/tags/form"%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">	&lt;form:form action="$&#123;pageContext.request.contextPath &#125;/emp"</div><div class="line">		method="POST" modelAttribute="employee"&gt;</div><div class="line">		&lt;c:if test="$&#123;employee.id == null &#125;"&gt;</div><div class="line">		LastName:&lt;form:input path="lastName" /&gt;</div><div class="line">		&amp;nbsp;&lt;form:errors path="lastName"&gt;&lt;/form:errors&gt;</div><div class="line">			&lt;br&gt;</div><div class="line">			&lt;br&gt;</div><div class="line">		&lt;/c:if&gt;</div><div class="line">		&lt;c:if test="$&#123;employee.id != null &#125;"&gt;</div><div class="line">			&lt;form:hidden path="id" /&gt;</div><div class="line">			&lt;input type="hidden" name="_method" value="PUT"&gt;</div><div class="line">			&lt;%-- 对于 _method 不能使用 form:hidden 标签, 因为 modelAttribute 对应的 bean 中没有 _method 这个属性 --%&gt;</div><div class="line">			&lt;%-- </div><div class="line">			&lt;form:hidden path="_method" value="PUT"/&gt;</div><div class="line">			--%&gt;</div><div class="line">		&lt;/c:if&gt;</div><div class="line">		</div><div class="line">		Email:&lt;form:input path="email" /&gt;</div><div class="line">		&amp;nbsp;&lt;form:errors path="email"&gt;&lt;/form:errors&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		&lt;%</div><div class="line">			Map&lt;String, String&gt; genders = new HashMap&lt;String, String&gt;();</div><div class="line">				genders.put("0", "Female");</div><div class="line">				genders.put("1", "Male");</div><div class="line">				request.setAttribute("genders", genders);</div><div class="line">		%&gt;</div><div class="line">		Gender:&lt;form:radiobuttons path="gender" items="$&#123;genders &#125;" /&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		Birth:&lt;form:input path="birth" /&gt;</div><div class="line">		&amp;nbsp;&lt;form:errors path="birth"&gt;&lt;/form:errors&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		Department:&lt;form:select path="department.id" items="$&#123;departments &#125;"</div><div class="line">			itemLabel="departmentName" itemValue="id"&gt;&lt;/form:select&gt;</div><div class="line">		&lt;input type="submit" value="Submit" /&gt;</div><div class="line">	&lt;/form:form&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>WEB-INF/views/list.jsp<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"</div><div class="line">	pageEncoding="UTF-8"%&gt;</div><div class="line">&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line">&lt;script type="text/javascript"</div><div class="line">	src="$&#123;pageContext.request.contextPath &#125;/scripts/jquery-1.9.1.min.js"&gt;&lt;/script&gt;</div><div class="line">&lt;script type="text/javascript"&gt;</div><div class="line">	$(function() &#123;</div><div class="line">		$(".delete").click(function() &#123;</div><div class="line">			var href = $(this).attr("href");</div><div class="line">			$("form").attr("action", href).submit();</div><div class="line">			return false;</div><div class="line">		&#125;);</div><div class="line">	&#125;)</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">	&lt;form action="" method="POST"&gt;</div><div class="line">		&lt;input type="hidden" name="_method" value="DELETE"&gt;</div><div class="line">	&lt;/form&gt;</div><div class="line">	&lt;c:if test="$&#123;empty requestScope.employees &#125;"&gt;</div><div class="line"> no employees information.</div><div class="line">&lt;/c:if&gt;</div><div class="line">	&lt;c:if test="$&#123;!empty requestScope.employees &#125;"&gt;</div><div class="line">		&lt;table border="1" cellpadding="10" cellspacing="0"&gt;</div><div class="line">			&lt;tr&gt;</div><div class="line">				&lt;th&gt;ID&lt;/th&gt;</div><div class="line">				&lt;th&gt;LastName&lt;/th&gt;</div><div class="line">				&lt;th&gt;Email&lt;/th&gt;</div><div class="line">				&lt;th&gt;Gender&lt;/th&gt;</div><div class="line">				&lt;th&gt;Birth&lt;/th&gt;</div><div class="line">				&lt;th&gt;Department&lt;/th&gt;</div><div class="line">				&lt;th&gt;Edit&lt;/th&gt;</div><div class="line">				&lt;th&gt;Delete&lt;/th&gt;</div><div class="line">			&lt;/tr&gt;</div><div class="line">			&lt;c:forEach items="$&#123;requestScope.employees &#125;" var="emp"&gt;</div><div class="line">				&lt;tr&gt;</div><div class="line">					&lt;td&gt;$&#123;emp.id &#125;&lt;/td&gt;</div><div class="line">					&lt;td&gt;$&#123;emp.lastName &#125;&lt;/td&gt;</div><div class="line">					&lt;td&gt;$&#123;emp.email &#125;&lt;/td&gt;</div><div class="line">					&lt;td&gt;$&#123;emp.gender == 0 ? 'Female' : 'male' &#125;&lt;/td&gt;</div><div class="line">					&lt;td&gt;$&#123;emp.birth &#125;&lt;/td&gt;</div><div class="line">					&lt;td&gt;$&#123;emp.department.departmentName &#125;&lt;/td&gt;</div><div class="line">					&lt;td&gt;&lt;a</div><div class="line">						href="$&#123;pageContext.request.contextPath &#125;/emp/$&#123;emp.id &#125;"&gt;Edit&lt;/a&gt;&lt;/td&gt;</div><div class="line">					&lt;td&gt;&lt;a class="delete"</div><div class="line">						href="$&#123;pageContext.request.contextPath &#125;/emp/$&#123;emp.id &#125;"&gt;Delete&lt;/a&gt;&lt;/td&gt;</div><div class="line">				&lt;/tr&gt;</div><div class="line"></div><div class="line">			&lt;/c:forEach&gt;</div><div class="line">		&lt;/table&gt;</div><div class="line">	&lt;/c:if&gt;</div><div class="line">	&lt;a href="$&#123;pageContext.request.contextPath &#125;/emp"&gt;Add New Employee&lt;/a&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>web.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">	<span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></div><div class="line">	<span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 配置 org.springframework.web.filter.HiddenHttpMethodFilter: 可以把 POST </span></div><div class="line">		请求转为 DELETE 或 PUT 请求 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 配置 DispatcherServlet --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>springmvc.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></div><div class="line">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</div><div class="line">		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 配置要自动扫描的包 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.MySpringMVC"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 配置视图解析器: 如何把 handler 方法返回值解析为实际的物理视图 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- default-servlet-handler 将在 SpringMVC 上下文中定义一个 DefaultServletHttpRequestHandler, </span></div><div class="line">		它会对进入 DispatcherServlet 的请求进行筛查, 如果发现是没有经过映射的请求, 就将该请求交由 WEB 应用服务器默认的 Servlet </div><div class="line">		处理. 如果不是静态资源的请求，才由 DispatcherServlet 继续处理 一般 WEB 应用服务器默认的 Servlet 的名称都是 default. </div><div class="line">		若所使用的 WEB 服务器的默认 Servlet 名称不是 default，则需要通过 default-servlet-name 属性显式指定 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 解决 配置了 mvc:default-servlet-handler 或者 mvc:view-controller 后，控制器不能正常映射请求 </span></div><div class="line">		的问题 还会会默认装配好一个LocalValidatorFactoryBean，用于数据校验 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>lib目录：<br><img src="http://static.zybuluo.com/xiangwanpeng/blqehoho6ibmn25ee82k0i7l/image_1b1dmlo7b1cnc1f3sn7fv4cb171g.png" alt="image_1b1dmlo7b1cnc1f3sn7fv4cb171g.png-60.7kB"></p>
<h2 id="核心知识点"><a href="#核心知识点" class="headerlink" title="核心知识点"></a>核心知识点</h2><p><strong>1、SpringMVC的form标签：</strong></p>
<p>　　<strong>1.1</strong> 通过SpringMVC的<strong>form</strong>标签可以实现将模型数据中的属性和HTML 表单元素相绑定，以实现表单数据更便捷编辑和表单值的回显。<br>　　<strong>1.2</strong> 可以通过SpringMVC的<strong>form</strong>标签的modelAttribute属性指定绑定的模型属性以进行表单回显。<br>　　<strong>1.3</strong> SpringMVC的<strong>form</strong>标签默认一定要回显表单，若没有指定modelAttribute属性，则默认从request 域对象中读取command的表单bean。如果在 指定的modelAttribute 或者 command 中无法获取到某一属性，则会发生错误。<br>　　<br><strong>2、处理静态资源：</strong></p>
<p>　　<strong>2.1</strong> 优雅的REST 风格的资源URL 不希望带.html 或.do 等后缀，若将DispatcherServlet请求映射配置为/，则Spring MVC 将捕获WEB 容器的所有请求，包括静态资源的请求（例如使用jQuery），SpringMVC会将他们当成一个普通请求处理，因找不到对应处理器将导致错误。<br>　　<br>　　<strong>2.2</strong> 上述问题的解决方法为：在SpringMVC的配置文件中添加配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>其原理是：default-servlet-handler 将在 SpringMVC 上下文中定义一个 DefaultServletHttpRequestHandler，它会对进入 DispatcherServlet 的请求进行筛查，如果发现是没有经过映射的请求， 就将该请求交由 WEB 应用服务器默认的 Servlet 处理。如果不是静态资源的请求，才由 DispatcherServlet 继续处理。一般情况下，WEB 应用服务器默认的 Servlet 的名称都是 default。若所使用的 WEB 服务器的默认 Servlet 名称不是 default，则需要通过 default-servlet-name 属性显式指定。</p>
<p><strong>3.数据转换&amp;数据格式化&amp;数据校验</strong></p>
<p>　　<strong>3.1 数据绑定流程：</strong><br>　　① Spring MVC主框架将ServletRequest对象及目标方法的入参实例传递给WebDataBinderFactory实例，以创建DataBinder实例对象；<br>　　② DataBinder调用装配在Spring MVC上下文中的ConversionService组件进行数据类型转换、数据格式化工作。将Servlet 中的请求信息填充到入参对象中；<br>　　③ 调用Validator组件对已经绑定了请求消息的入参对象进行数据合法性校验，并最终生成数据绑定结果BindingData对象；<br>　　④ Spring MVC抽取BindingResult中的入参对象和校验错误对象，将它们赋给处理方法的响应入参<br>　　Spring MVC通过反射机制对目标处理方法进行解析，将请求消息绑定到处理方法的入参中。数据绑定的核心部件是DataBinder，运行机制如下：<br>　　<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/hl7ecxcr3bocje970a2ngjdj/image_1b1doigq71hd01kg01e6cqbd150q2j.png" alt="image_1b1doigq71hd01kg01e6cqbd150q2j.png-77.5kB"><br>　　<br>　　实现源码：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/6dwjwfovhx3fwixmtq6ylv96/image_1b1dohstp1v2tjt8rstfue1n9o26.png" alt="image_1b1dohstp1v2tjt8rstfue1n9o26.png-236.9kB"><br>　　<br>　　<strong>3.2 数据转换</strong><br>　　Spring MVC 上下文中内建了很多转换器，可完成大多数Java 类型的转换工作，如下图：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/hf3nbxsrbu9u4txhewjpb9p2/image_1b1dp9ap5105bn081nmlna5bnj30.png" alt="image_1b1dp9ap5105bn081nmlna5bnj30.png-215.9kB"><br>　　<br>　　如果内建的转换器不能满足要求，可以自定义转换器。方法是利用 <strong>ConversionServiceFactoryBean</strong> 在Spring 的IOC 容器中定义一个 <strong>ConversionService</strong>，并通过ConversionServiceFactoryBean的 <strong>converters</strong> 属性注册自定义的类型转换器。Spring 将自动识别出IOC 容器中的ConversionService，并在Bean 属性配置及Spring MVC 处理方法入参绑定等场合使用它进行数据的转换。例如现在要实现一个将String转为Employee对象的转换器：(这里的Employee没有添加birth属性)<br>　　<br>springmvc.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 将自定义的ConversionService注册到Spring MVC 的上下文中 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"conversionService"</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span>	</div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 配置 ConversionService --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"employeeConverter"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span>	</div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>jsp:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;form action="testConversionServiceConverer" method="POST" &gt;          </div><div class="line">&lt;!-- lastname-email-gender-department.id 例如: GG-gg@atguigu.com-0-105 --&gt;  </div><div class="line">        Employee: &lt;input type="text" name="employee"/&gt;  </div><div class="line">        &lt;input type="submit" value="Submit"/&gt;  </div><div class="line">    &lt;/form&gt;</div></pre></td></tr></table></figure></p>
<p>controller:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testConversionServiceConverer"</span>)  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testConverter</span><span class="params">(@RequestParam(<span class="string">"employee"</span>)</span> Employee employee)</span>&#123;  </div><div class="line">        System.out.println(<span class="string">"save: "</span> + employee);  </div><div class="line">        employeeDao.save(employee);  </div><div class="line">        <span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>Converter:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Employee</span>&gt; </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;  </div><div class="line">        <span class="keyword">if</span>(source != <span class="keyword">null</span>)&#123;  </div><div class="line">            String [] vals = source.split(<span class="string">"-"</span>);  </div><div class="line">            <span class="comment">//GG-gg@atguigu.com-0-105  </span></div><div class="line">            <span class="keyword">if</span>(vals != <span class="keyword">null</span> &amp;&amp; vals.length == <span class="number">4</span>)&#123;  </div><div class="line">                String lastName = vals[<span class="number">0</span>];  </div><div class="line">                String email = vals[<span class="number">1</span>];  </div><div class="line">                Integer gender = Integer.parseInt(vals[<span class="number">2</span>]);  </div><div class="line">                Department department = <span class="keyword">new</span> Department();  </div><div class="line">                department.setId(Integer.parseInt(vals[<span class="number">3</span>]));  </div><div class="line">  </div><div class="line">                Employee employee = <span class="keyword">new</span> Employee(<span class="keyword">null</span>, lastName, email, gender, department);  </div><div class="line">                System.out.println(source + <span class="string">"--convert--"</span> + employee);  </div><div class="line">                <span class="keyword">return</span> employee;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　<strong>3.3 数据格式化</strong><br>　　对属性对象的输入/输出进行格式化，从其本质上讲依然属于“类型转换”的范畴。Spring 在格式化模块中定义了一个实现ConversionService接口的FormattingConversionService实现类，该实现类扩展了GenericConversionService，因此它既具有类型转换的功能，又具有格式化的功能。FormattingConversionService拥有一个FormattingConversionServiceFactroyBean工厂类，后者用于在Spring 上下文中构造前者。<br>　　FormattingConversionServiceFactroyBean内部已经注册了:</p>
<ul>
<li><p>NumberFormatAnnotationFormatterFactroy：支持对数字类型的属性使用@NumberFormat注解</p>
</li>
<li><p>JodaDateTimeFormatAnnotationFormatterFactroy：支持对日期类型的属性使用@DateTimeFormat注解</p>
</li>
</ul>
<p>　　装配了FormattingConversionServiceFactroyBean后，就可以在Spring MVC 入参绑定及模型数据输出时使用注解驱动了。<strong>mvc:annotation-driven标签 默认创建的ConversionService 实例即为 FormattingConversionServiceFactroyBean</strong>。<br>　　例如，我们在Employee.java中的birth属性上添加了注解：@DateTimeFormat(pattern=”yyyy-MM-dd”)，即指定了日期输入的格式。此外，还可通过@NumberFormat注解对类似数字类型的属性进行格式化标注，例如<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　　<span class="meta">@NumberFormat</span>(pattern=<span class="string">"#,###,###.#"</span>)  </div><div class="line"><span class="keyword">private</span> Float salary;</div></pre></td></tr></table></figure></p>
<p>　　<strong>3.4 数据校验</strong><br>　　JSR 303是Java 为Bean 数据合法性校验提供的标准框架，它已经包含在JavaEE 6.0中。JSR 303通过在Bean 属性上标注类似于@NotNull、@Max等标准的注解指定校验规则，并通过标准的验证接口对Bean 进行验证。详细注解如下图：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/y5t8muqjo7qgfqthizj8msdq/image_1b1ds94ej1m5d1c9h2oo118g13vc3t.png" alt="image_1b1ds94ej1m5d1c9h2oo118g13vc3t.png-208.7kB"><br>　　<br>　　hibernate Validator是JSR 303 的一个参考实现，除支持所有标准的校验注解外，它还支持以下的扩展注解：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/otoyltxu91jtya4m035h7znf/image_1b1dsabituub1vpsv23grg1f2f4a.png" alt="image_1b1dsabituub1vpsv23grg1f2f4a.png-159.3kB"><br>　　<br><strong>Spring MVC 数据校验：</strong> </p>
<p>　　Spring 4.0拥有自己独立的数据校验框架，同时支持JSR 303标准的校验框架。<br>　　Spring 在进行数据绑定时，可同时调用校验框架完成数据校验工作。在Spring MVC 中，可直接通过注解驱动的方式进行数据校验。<br>　　Spring 的LocalValidatorFactroyBean既实现了Spring 的Validator 接口，也实现了JSR 303 的Validator接口。只要在Spring 容器中定义了一个LocalValidatorFactoryBean，即可将其注入到需要数据校验的Bean 中。<strong>mvc:annotation-driven标签</strong> 会默认装配好一个LocalValidatorFactoryBean，通过在<strong>处理方法的入参上标注@valid注解</strong>即可让Spring MVC 在完成数据绑定后执行数据校验的工作。<br>　　Spring 本身并没有提供JSR303 的实现，所以必须将JSR303 的实现者的jar 包放到类路径下:<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/wpqhb9q2gbo8btbfo2yjb9ag/image_1b1dsi76s5j875d19k014n2nao4n.png" alt="image_1b1dsi76s5j875d19k014n2nao4n.png-10.6kB"><br>　　<br>　　Spring MVC 是通过对处理方法签名的规约来保存校验结果的：<strong>前一个表单/命令对象的校验结果保存到随后的入参中</strong>，这个保存校验结果的入参必须是BindingResult或Errors类型，这两个类都位于org.springframework.validation包中。<strong>需校验的Bean 对象和其绑定结果对象或错误对象时成对出现的，它们之间不允许声明其他的入参</strong>。<br>　　例如，在上述的EmployeeHandler类的save方法中即声明了需要对employee入参进行校验，并将校验结果存入result中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/emp"</span>, method = RequestMethod.POST)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">(@Valid Employee employee, BindingResult result, Map&lt;String, Object&gt; map)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (result.getErrorCount() &gt; <span class="number">0</span>) &#123;</div><div class="line">			System.out.println(<span class="string">"出错了！"</span>);</div><div class="line">			<span class="keyword">for</span> (FieldError error : result.getFieldErrors()) &#123;</div><div class="line">				System.out.println(error.getField() + <span class="string">":"</span> + error.getDefaultMessage());</div><div class="line">			&#125;</div><div class="line">			map.put(<span class="string">"departments"</span>, departmenDao.getDepartments());</div><div class="line">			<span class="keyword">return</span> <span class="string">"input"</span>;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		employeeDao.save(employee);</div><div class="line">		<span class="keyword">return</span> <span class="string">"redirect:/emps"</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>其中对employee的哪些字段进行何种校验，Employee.java中已经标注了，例如<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@NotEmpty</span></div><div class="line">	<span class="keyword">private</span> String lastName;</div></pre></td></tr></table></figure></p>
<p>标注了lastName字段不能为null。</p>
<p><strong>在目标方法中获取校验结果：</strong><br>　　上面save方法的代码已经介绍了如何利用校验结果的信息在目标方法中进行打印。<br>　　<br><strong>在页面上显示错误：</strong><br>　　Spring MVC 除了会将表单/命令对象的校验结果保存到对应的BindingResult或Errors 对象中外，还会将所有校验结果保存到“隐含模型”，即implicitModel。隐含模型中的所有数据最终将通过HttpServletRequest的属性列表暴露给JSP 视图对象，因此在JSP 中可以获取错误信息。例如，如果上述的lastName字段为null，则可以在跳转的页面input.jsp中通过如下代码获取错误信息。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　&lt;form:errors path="lastName"&gt;&lt;/form:errors&gt;</div></pre></td></tr></table></figure></p>
<p><strong>提示消息的国际化：</strong><br>　　 每个属性在数据绑定和数据校验发生错误时，都会生成一个对应的FieldError对象。当一个属性校验失败后，校验框架会为该属性生成4 个消息代码，这些代码以校验注解类名为前缀，结合modleAttribute、属性名及属性类型名生成多个对应的消息代码：例如User 类中的password 属性标准了一个@Pattern 注解，当该属性值不满足@Pattern 所定义的规则时, 就会产生以下4 个错误代码：</p>
<ul>
<li>Pattern.user.password</li>
<li>Pattern.password</li>
<li>Pattern.java.lang.String</li>
<li>Pattern</li>
</ul>
<p>　　当使用Spring MVC 标签显示错误消息时，Spring MVC 会查看WEB 上下文是否装配了对应的国际化消息，如果没有，则显示默认的错误消息，否则使用国际化消息。例如，我们要定制lastName字段的验证出错的错误消息：<br>　　<br>创建国际化资源文件 i18n.properties：(其中“LastName\u4E0D\u80FD\u4E3A\u7A7A”是输入汉字“LastName不能为空”自动转换为ISO-8859-1编码的结果)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NotEmpty.employee.lastName=LastName\u4E0D\u80FD\u4E3A\u7A7A</div></pre></td></tr></table></figure></p>
<p>在springmvc.xml中配置国际化资源文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置国际化资源文件 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSource"</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.context.support.ResourceBundleMessageSource"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basename"</span> <span class="attr">value</span>=<span class="string">"i18n"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>那么如果lastName字段为null，错误信息将会是：LastName不能为空。<br>　　<br>　　若数据类型转换或数据格式转换时发生错误，或该有的参数不存在，或调用处理方法时发生错误，都会在隐含模型中创建错误消息。其错误代码前缀说明如下：</p>
<ul>
<li>required：必要的参数不存在。如@RequiredParam(“param1”) 标注了一个入参，但是该参数不存在。</li>
<li>typeMismatch：在数据绑定时，发生数据类型不匹配的问题</li>
<li>methodInvocation：Spring MVC。 在调用处理方法时发生了错误–注册国际化资源文件。</li>
</ul>
<p><strong>4、关于mvc:annotation-driven</strong><br>　　<strong>mvc:annotation-driven</strong> 会自动注册RequestMappingHandlerMapping、RequestMappingHandlerAdapter与ExceptionHandlerExceptionResolver三个bean。还将提供以下支持：</p>
<ul>
<li>支持使用ConversionService实例对表单参数进行类型转换（不加的话就没有ConversionService）</li>
<li>支持使用@NumberFormat、@DateTimeFormat注解完成数据类型的格式化</li>
<li>支持使用@Valid注解对JavaBean 实例进行JSR 303验证</li>
<li>支持使用@RequestBody和@ResponseBody注解</li>
</ul>
<p><strong>5、关于@InitBinder注解</strong><br>　　由@InitBinder标识的方法，可以对WebDataBinder对象进行初始化。WebDataBinder是DataBinder的子类，用于完成由表单字段到JavaBean 属性的绑定。<br>　　@InitBinder方法不能有返回值，它必须声明为void。<br>　　@InitBinder方法的参数通常是WebDataBinder。<br>　　例如，如下代码声明了不将请求参数中的lastName属性绑定到WebDataBinder中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//lastName不进行赋值，（不自动绑定对象中的lastName属性，另行处理）    user的角色赋值的时候可能会用到  </span></div><div class="line">    <span class="meta">@InitBinder</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initBinder</span><span class="params">(WebDataBinder binder)</span></span>&#123;  </div><div class="line">        binder.setDisallowedFields(<span class="string">"lastName"</span>);  </div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/12/SpringMVC中的视图和视图解析器/" itemprop="url">
                  SpringMVC中的视图和视图解析器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-12T20:04:14+08:00" content="2016-11-12">
              2016-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/12/SpringMVC中的视图和视图解析器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/12/SpringMVC中的视图和视图解析器/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　对于控制器的目标方法，无论其返回值是String、View、ModelMap或是ModelAndView，SpringMVC都会在内部将它们封装为一个ModelAndView对象进行返回。<br>　　 Spring MVC 借助视图解析器（ViewResolver）得到最终的视图对象（View），最终的视图可以是JSP也可是Excell、<br>JFreeChart等各种表现形式的视图。</p>
<h2 id="SpringMVC的视图解析流程"><a href="#SpringMVC的视图解析流程" class="headerlink" title="SpringMVC的视图解析流程"></a>SpringMVC的视图解析流程</h2><p>　　SpringMVC的视图解析流程为：<br>　　<br>1、调用目标方法，SpringMVC将目标方法返回的String、View、ModelMap或是ModelAndView都转换为一个ModelAndView对象；</p>
<p>2、然后通过视图解析器（ViewResolver）对ModelAndView对象中的View对象进行解析，将该逻辑视图View对象解析为一个物理视图View对象；</p>
<p>3、最后调用物理视图View对象的render()方法进行视图渲染，得到响应结果。</p>
<h2 id="视图（View）"><a href="#视图（View）" class="headerlink" title="视图（View）"></a>视图（View）</h2><p>　　视图的作用是渲染模型数据，将模型里的数据以某种形式呈现给客户。<br>　　为了实现视图模型和具体实现技术的解耦，Spring在org.springframework.web.servlet包中定义了一个高度抽象的View接口。<br>　　视图对象由视图解析器负责实例化。由于视图是无状态的，所以他们不会有线程安全的问题。所谓视图是无状态的，是指对于每一个请求，都会创建一个View对象。<br>　　JSP是最常见的视图技术。<br>　　<br>　　常用的视图实现类：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/vu68o9mlhuqulbbo282fwcyk/image_1b1ce221b11hn6kv3pv1jj4kcm9.png" alt="image_1b1ce221b11hn6kv3pv1jj4kcm9.png-351.2kB"></p>
<h2 id="视图解析器（ViewResolver）"><a href="#视图解析器（ViewResolver）" class="headerlink" title="视图解析器（ViewResolver）"></a>视图解析器（ViewResolver）</h2><p>　　视图解析器的作用是将逻辑视图转为物理视图，所有的视图解析器都必须实现ViewResolver接口。<br>　　 SpringMVC为逻辑视图名的解析提供了不同的策略，可以在Spring WEB上下文中<strong>配置一种或多种解析策略，并指定他们之间的先后顺序</strong>。每一种映射策略对应一个具体的视图解析器实现类。程序员可以选择一种视图解析器或混用多种视图解析器。可以通过order属性指定解析器的优先顺序，order越小优先级越高，SpringMVC会按视图解析器顺序的优先顺序对逻辑视图名进行解析，直到解析成功并返回视图对象，否则抛出ServletException异常。<br>　　<br>　　 常用的视图解析器实现类：<br>　　 <img src="http://static.zybuluo.com/xiangwanpeng/147utwe99kdvoez5i2swxgti/image_1b1ce6cmvcq619dl1fv19i3fg29.png" alt="image_1b1ce6cmvcq619dl1fv19i3fg29.png-264.4kB"><br>　　<br>　　 以下是通过InternalResourceViewResolver作为视图解析器解析，将逻辑视图解析为JSP视图的实例：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>　　若项目中使用了JSTL，则SpringMVC会自动把视图由InternalResourceView转为JstlView。
　　</p>
<h2 id="使用mvc-view-controller不经控制器直接跳转到页面"><a href="#使用mvc-view-controller不经控制器直接跳转到页面" class="headerlink" title="使用mvc:view-controller不经控制器直接跳转到页面"></a>使用mvc:view-controller不经控制器直接跳转到页面</h2><p>　　若希望直接响应通过SpringMVC渲染的页面，可以使用mvc:view-controller标签实现：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">　　<span class="comment">&lt;!-- 配置直接转发的页面 --&gt;</span>      </div><div class="line"><span class="comment">&lt;!-- 可以直接相应转发的页面, 而无需再经过 Handler 的方法.  --&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/success"</span> <span class="attr">view-name</span>=<span class="string">"success"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>　　那么现在可以直接在某一页面中通过请求路径”success”访问到/WEB-INF/views/success.jsp页面（因为我们上面配置了视图解析器将逻辑视图解析为前缀为/WEB-INF/views/，后缀为.jsp的物理视图）。但是，这种情况下通过控制器就无法映射到请求了，需要再进行如下配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 在实际开发中通常都需配置 mvc:annotation-driven 标签，  之前的页面才不会因为配置了直接转发页面而受到影响 --&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>　　 </p>
<h2 id="关于重定向"><a href="#关于重定向" class="headerlink" title="关于重定向"></a>关于重定向</h2><p>　　一般情况下，控制器方法返回字符串类型的值会被当成逻辑视图名处理，但如果返回的字符串中带forward:或redirect:前缀时，SpringMVC会对它们进行特殊处理：将forward: 和redirect: 当成指示符，其后的字符串作为URL 来处理。示例如下：<br>　　<br>index.jsp：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href="$&#123;pageContext.request.contextPath &#125;/springmvc/testRedirect"&gt;Test Redirect&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>controller:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/springmvc"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMVCTest</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testRedirect"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testRedirect</span><span class="params">()</span> </span>&#123;</div><div class="line">   		System.out.println(<span class="string">"testRedirect"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="string">"redirect:/index.jsp"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>即可重定向到index.jsp。也可在redirect:/后添加控制器方法的映射路径，重定向到该目标方法。</p>
<p>　　 </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/11/在JSP中引用JS文件的三种方法/" itemprop="url">
                  在JSP中引用JS文件的三种方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-11T09:55:50+08:00" content="2016-11-11">
              2016-11-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Jquery/" itemprop="url" rel="index">
                    <span itemprop="name">Jquery</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/11/在JSP中引用JS文件的三种方法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/11/在JSP中引用JS文件的三种方法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="在JSP中引用JS文件的三种方法："><a href="#在JSP中引用JS文件的三种方法：" class="headerlink" title="在JSP中引用JS文件的三种方法："></a>在JSP中引用JS文件的三种方法：</h2><p>1、如果是直接访问JSP，则使用相对于JSP页面的相对路径：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/wvb5ydr3gvw7q259ja048kz9/image_1b18hnotn96o1psa12es191r1ma69.png" alt="image_1b18hnotn96o1psa12es191r1ma69.png-7.1kB"></p>
<p>当项目目录如图所示时，则在NewFile.jsp中访问jquery-1.9.1.min.js的方法为：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script type="text/javascript" src="../scripts/jquery-1.9.1.min.js"&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>2、如果是从action跳转至JSP，则使用相对于WEB工程的相对路径：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/wvb5ydr3gvw7q259ja048kz9/image_1b18hnotn96o1psa12es191r1ma69.png" alt="image_1b18hnotn96o1psa12es191r1ma69.png-7.1kB"></p>
<p>如果是从某一个action跳转到NewFile.jsp，则在NewFile.jsp中访问jquery-1.9.1.min.js的方法为：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script type="text/javascript" src="scripts/jquery-1.9.1.min.js"&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>3、适用于以上两种情况的方法——使用WEB工程的绝对路径：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script type="text/javascript" src="$&#123;pageContext.request.contextPath &#125;/scripts/jquery-1.9.1.min.js"&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/07/深入理解@ModelAttribute注解的工作过程/" itemprop="url">
                  深入理解@ModelAttribute注解的工作过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-07T16:38:32+08:00" content="2016-11-07">
              2016-11-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/07/深入理解@ModelAttribute注解的工作过程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/07/深入理解@ModelAttribute注解的工作过程/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　在SpringMVC中，我们可以通过使用@ModelAttribute注解标记方法，实现类似于Struts2中Preparable拦截器的效果，其使用方法我们已经在<a href="http://blog.csdn.net/xiangwanpeng/article/details/53057104" target="_blank" rel="external">《SpringMVC中如何处理模型数据》</a>中讲述过了。<br>　　现在我们仍以上篇文章中的更新操作为例，来讨论@ModelAttribute的工作过程。即：有一个User类，有id、userName、email三个属性。现在要完成一个更新操作，但是其中有一项属性不能被修改，例如id，那么只能修改两项属性，userName和email，所以从form表单传递的信息就只能有这两项，我们是通过@ModelAttribute注解标记方法来实现的：（其中数据库相关的操作仅采用模拟的方式）<br>　　<br>index.jsp：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">　&lt;!--  </div><div class="line">		模拟修改操作</div><div class="line">		1. 原始数据为: 1,Jack,Jack@163.com</div><div class="line">		2. 将username和email修改为Mike、Mike@qq.com，id不能被修改.</div><div class="line">		3. 表单回显, 模拟操作直接在表单填写对应的属性值</div><div class="line">	--&gt;</div><div class="line">&lt;form action="springmvc/testModelAttribute" method="Post"&gt;</div><div class="line">		username: &lt;input type="text" name="username" value="Jack"/&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		email: &lt;input type="text" name="email" value="Jack@163.com"/&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		&lt;input type="submit" value="Submit"/&gt;</div><div class="line">	&lt;/form&gt;</div></pre></td></tr></table></figure></p>
<p>　　<br>controller：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ModelAttribute</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"modelAttribute method"</span>);</div><div class="line">			<span class="comment">// 模拟从数据库中获取对象</span></div><div class="line">			User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"Jack"</span>, <span class="string">"Jack@163.com"</span>);</div><div class="line">			System.out.println(<span class="string">"从数据库中获取一个对象: "</span> + user);</div><div class="line">			map.put(<span class="string">"user"</span>, user);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testModelAttribute"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testModelAttribute</span><span class="params">(User user)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"修改: "</span> + user);</div><div class="line">		<span class="keyword">return</span> SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行后，在控制台输出：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/3lq26obzpz66feqbsouq9zhm/image_1b0v1k02qrkq1ush8p915mj1k639.png" alt="image_1b0u4nqt51qsb1b4019hq1fme1h5cm.png-21kB"></p>
<p>　　在这个例子中，SpringMVC通过映射请求调用目标处理方法testModelAttribute方法<strong>之前</strong>，做了下面三件事情：<br>　　<strong>第1步：</strong> 执行 @ModelAttribute 注解修饰的方法： 从数据库中取出对象，把对象放入到了 Map 中，键为：user。<br>　　<strong>第2步：</strong> SpringMVC 从 Map 中取出 User 对象 user， 并把表单的请求参数赋给 user 的对应属性。<br>　　<strong>第3步：</strong> SpringMVC 把上述对象作为参数传入目标方法testModelAttribute(User user)。<br>　　<br>　　通过阅读SpringMVC的源码，我了解了这三个步骤具体是这样实现的：<br>　　<br>　　<strong>第1步：</strong> 执行 @ModelAttribute 注解修饰的方法，<strong>实际上把 @ModelAttribute 方法中 Map 中的数据user放在了 implicitModel（这是一个BindingAwareModelMap类型的对象，BindingAwareModelMap类型实现了Map接口） 中</strong>。<br>　　<br>　　<strong>第2步：</strong>核心的功能都在第2步实现，这一步主要做了三件事，其中核心步骤是前两件事，即 2.1 和 2.2 ：<br>　　<br>　　　<strong>2.1（第一件事）：确定查找键值对所需要的键（key）：</strong><br>　　　<br>　　　　<strong>2.1.1：</strong>若目标方法的 POJO 类型的参数<strong>没有使用 @ModelAttribute 作为修饰</strong>, 则 key 为 POJO <strong>类名第一个字母的小写</strong>；<br>　　　　<strong>2.1.2：</strong>若目标方法的 POJO 类型的参数<strong>使用了@ModelAttribute 来修饰</strong>, 则 key 为 <strong>@ModelAttribute 注解的 value 属性值</strong>。<br>　　在上面的例子中，目标方法testModelAttribute(User user)中的入参没有被@ModelAttribute修饰，所以key值为POJO 类名第一个字母的小写形式，即“user”。<br>　　<br>　　　<strong>2.2（第二件事）：在 implicitModel（即map） 中查找 key 对应的对象：</strong><br>　　　<br>　　　　<strong>2.2.1：</strong>若 @ModelAttribute 标记的方法在 Map 中<strong>保存过</strong>这样一个键值对, <strong>其 key 和 2.1 确定的 key 一致</strong>, 则会获取到key对应的键值对的value值；<br>　　　　<strong>2.2.2：</strong>若 implicitModel 中<strong>不存在</strong> key 对应的对象，则检查当前的<strong>控制器类是否被@SessionAttributes注解修饰</strong>，<strong>如果使用了@SessionAttributes注解修饰</strong>，<strong>且@SessionAttributes注解的value值中包含了key</strong>，则尝试从HttpSession中获取key所对应的value值，<strong>如果value值存在则获取到</strong>，<strong>如果value值不存在则抛出异常</strong>。<br>　　　　<strong>2.2.3：</strong>如果<strong>没有使用@SessionAttributes注解修饰该控制器类</strong>，或者<strong>使用了，但是@SessionAttributes注解中的value值不包含key</strong>，则SpringMVC会<strong>通过反射来创建一个POJO类型的对象</strong>。<br>　　　　<br>　　　<strong>2.3（第三件事）：</strong>，用表单中传递过来的参数值去更新2.2确定的value值（或通过反射建立的对象）。<br>　　　　<br>　　<strong>第3步：</strong>同上面的第3步描述的一样，即SpringMVC 把上述对象作为参数传入目标方法。<br>　　<br>　　以上就是@ModelAttribute注解的工作流程，我们了解了流程之后，就会发现，在2.2.2中有这样一种情况：如果：<br>　　①在 implicitModel 中不存在 key 对应的对象；<br>　　②控制器类有标记了@SessionAttributes注解；<br>　　③@SessionAttributes注解的value值中包含key；<br>　　④HttpSession域中不存在该key值对应的value值。<br>　　当同时满足这4种情况时，就会抛出异常，解决方法有两种：<br>　　1、通过@ModelAttribute注解修饰目标方法的入参，确定一个key值，使其不被包含在@SessionAttributes注解的value值中。<br>　　2、使用@ModelAttribute方法，在目标方法调用之前，将key对应的键值对放入implicitModel 中。
　　</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/06/SpringMVC中如何处理模型数据/" itemprop="url">
                  SpringMVC中如何处理模型数据
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-06T19:38:46+08:00" content="2016-11-06">
              2016-11-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringMVC/" itemprop="url" rel="index">
                    <span itemprop="name">SpringMVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/06/SpringMVC中如何处理模型数据/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/06/SpringMVC中如何处理模型数据/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　Spring MVC 提供了以下几种途径输出模型数据：</p>
<ul>
<li><strong>ModelAndView:</strong> 处理方法<strong>返回值类型</strong>为ModelAndView时, 方法体即可通过该对象添加模型数据</li>
<li><strong>Map 及Model:</strong> 入参为org.springframework.ui.Model、org.springframework.ui.ModelMap或java.util.Map时，处理方法返回时，Map中的数据会自动添加到模型中。</li>
<li><strong>@SessionAttributes:</strong> 将模型中的某个属性暂存到HttpSession中，以便多个请求之间可以共享这个属性</li>
<li><strong>@ModelAttribute:</strong> 方法入参标注该注解后, 入参的对象就会放到数据模型中<br>　　<br>下面对它们依次进行介绍：</li>
</ul>
<h2 id="ModelAndView："><a href="#ModelAndView：" class="headerlink" title="ModelAndView："></a>ModelAndView：</h2><p>　　可将控制器处理方法的返回值设为ModelAndView, ModelAndView中<strong>既可存放视图信息，也可存放模型数据信息</strong>。<br>　　<strong>SpringMVC 会把 ModelAndView 的 model 中数据放入到 request 域对象中</strong>。<br>　　<br><strong>ModelAndView设置视图的方法：</strong></p>
<ul>
<li>void setView(View view)</li>
<li>void setViewName(String viewName)</li>
</ul>
<p><strong>ModelAndView添加模型数据的方法：</strong></p>
<ul>
<li>MoelAndView addObject(String attributeName, Object attributeValue)</li>
<li>ModelAndView addAllObject(Map<string, ?=""> modelMap)</string,></li>
</ul>
<p>下面举例说明：</p>
<p>index.jsp：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href="springmvc/testModelAndView"&gt;Test ModelAndView&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>controller：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"success"</span>;</div><div class="line"><span class="comment">/**</span></div><div class="line">	 * 目标方法的返回值可以是 ModelAndView 类型。 </div><div class="line">	 * 其中可以包含视图和模型信息</div><div class="line">	 * SpringMVC 会把 ModelAndView 的 model 中数据放入到 request 域对象中. </div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testModelAndView"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testModelAndView</span><span class="params">()</span></span>&#123;</div><div class="line">		String viewName = SUCCESS;</div><div class="line">		ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView(viewName);</div><div class="line">		</div><div class="line">		<span class="comment">//添加模型数据到 ModelAndView 中.</span></div><div class="line">		modelAndView.addObject(<span class="string">"time"</span>, <span class="keyword">new</span> Date());</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> modelAndView;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>success.jsp：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">time : $&#123;requestScope.time &#125;</div></pre></td></tr></table></figure></p>
<p>运行会成功跳转到success.jsp并显示当前时间:</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/zxwa38fq1mnqxeajsu4m43bc/image_1b0spbdhjovc19ootuc1dgebnp9.png" alt="image_1b0spbdhjovc19ootuc1dgebnp9.png-13kB"></p>
<h2 id="Map及Model："><a href="#Map及Model：" class="headerlink" title="Map及Model："></a>Map及Model：</h2><p>　　Spring MVC 在调用方法前会创建一个隐含的模型对象作为模型数据的存储容器（事实上这个隐含的模型对象是一个BindingAwareModelMap 类型的对象，通过后面的例子我们可以验证），如果方法的入参为Map、Model或者ModelMap 类型，Spring MVC 会将隐含模型的引用传递给这些入参（因为BindingAwareModelMap 继承或实现了Map、Model或者ModelMap）。在方法体内，开发者可以通过这个入参对象访问到模型中的所有数据，也可以向模型中添加新的属性数据，SpringMVC 也会把 Map 中数据放入到 request 域对象中。<br>　　通常情况下使用的都是Map类型，下面我们以Map为例说明：<br>　　<br>index.jsp：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href="springmvc/testMap"&gt;Test Map&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>controller：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">	 * 目标方法可以添加 Map 类型(实际上也可以是 Model 类型或 ModelMap 类型)的参数.</div><div class="line">	 * </div><div class="line">	 * <span class="doctag">@param</span> map</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testMap"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testMap</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</div><div class="line">		System.out.println(map.getClass().getName());</div><div class="line">		map.put(<span class="string">"names"</span>, Arrays.asList(<span class="string">"Tom"</span>, <span class="string">"Jerry"</span>, <span class="string">"Mike"</span>));</div><div class="line">		<span class="keyword">return</span> SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>success.jsp：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">names: $&#123;requestScope.names &#125;</div></pre></td></tr></table></figure></p>
<p>运行程序成功跳转到success.jsp：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/w0qpz3im21rctmoa7ub741xa/image_1b0sqenm3154jii6vb21g4a1o1nm.png" alt="image_1b0sqenm3154jii6vb21g4a1o1nm.png-12.1kB"></p>
<p>并且在控制台输出了：</p>
<p><strong>org.springframework.validation.support.BindingAwareModelMap</strong></p>
<p>这说明Spring MVC在调用方法前创建的隐含的模型对象是 BindingAwareModelMap 类型。</p>
<h2 id="SessionAttributes："><a href="#SessionAttributes：" class="headerlink" title="@SessionAttributes："></a>@SessionAttributes：</h2><p>　　上面介绍的两种方式，SpringMVC都是将数据存放在request域对象中，若希望<strong>在多个请求之间共用某个模型属性数据</strong>，则可以在<strong>控制器类</strong>上标注一个@SessionAttributes注解（<strong>该注解只能放在类的上面， 而不能修饰放方法</strong>）, Spring MVC 将把模型中对应的属性暂存到HttpSession中。@SessionAttributes除了可以通过<strong>属性名</strong>指定需要放到会话中的属性外，还可以通过<strong>模型属性的对象类型</strong>指定哪些模型属性需要放到会话中，下面举例说明（User类代码略）：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href="springmvc/testSessionAttributes"&gt;Test SessionAttributes&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>controller：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@SessionAttributes</span> 除了可以通过属性名指定需要放到会话中的属性外(实际上使用的是 value 属性值),</div><div class="line">	 * 还可以通过模型属性的对象类型指定哪些模型属性需要放到会话中(实际上使用的是 types 属性值)</div><div class="line">	 * </div><div class="line">	 * 注意: 该注解只能放在类的上面. 而不能修饰放方法. </div><div class="line">	 */</div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testSessionAttributes"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testSessionAttributes</span><span class="params">(Map&lt;String,Object&gt; map)</span></span>&#123;</div><div class="line">		User user = <span class="keyword">new</span> User(<span class="string">"Jack"</span>,<span class="string">"123456"</span>,<span class="string">"Jack@163.com"</span>,<span class="number">20</span>);</div><div class="line">		map.put(<span class="string">"user"</span>, user);</div><div class="line">		map.put(<span class="string">"school"</span>, <span class="string">"HUST"</span>);</div><div class="line">		<span class="keyword">return</span> SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>success.jsp：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">request user : $&#123;requestScope.user &#125;</div><div class="line">&lt;br&gt;&lt;br&gt;</div><div class="line">session user : $&#123;sessionScope.user &#125;</div><div class="line">&lt;br&gt;&lt;br&gt;</div><div class="line">request school : $&#123;requestScope.school &#125;</div><div class="line">&lt;br&gt;&lt;br&gt;</div><div class="line">session school : $&#123;sessionScope.school &#125;</div><div class="line">&lt;br&gt;&lt;br&gt;</div></pre></td></tr></table></figure></p>
<p>　　现在，我们<strong>没有在该控制器类上标记@SessionAttributes注解</strong>，运行后跳转到success.jsp，页面显示如下：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/jh0jnjupohmbm0h7vc5v7c5u/image_1b0ssdm811mfs1nt3b3g1td6gvr2a.png" alt="image_1b0ssdm811mfs1nt3b3g1td6gvr2a.png-21.7kB"></p>
<p>　　即<strong>Map中的数据只被存放到了request域中，而没有被存放到session域中</strong>。现在，我们在该控制器类定义处添加@SessionAttributes注解：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/springmvc"</span>)</div><div class="line"><span class="meta">@SessionAttributes</span>(value=<span class="string">"user"</span>,types=&#123;String.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMVCTest</span> </span>&#123;</div><div class="line">        <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>@SessionAttributes(value=”user”,types={String.class})注解指定了属性名为user，<strong>或者</strong>类型为String的属性会被存放到session域中，现在运行程序，发现在success.jsp中既输出了request user和school，也输出了session user和school：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/fhlsnu6akigourmz4vjjdvou/image_1b0ss9u9q1718gft1ctbjgf1lf01t.png" alt="image_1b0ss9u9q1718gft1ctbjgf1lf01t.png-26.4kB"></p>
<h2 id="ModelAttribute："><a href="#ModelAttribute：" class="headerlink" title="@ModelAttribute："></a>@ModelAttribute：</h2><p>　　@ModelAttribute可以模拟出Struts2中Preparable拦截器的效果，想象这样一种情景：有一个User类，有id、userName、email三个属性。现在要完成一个修改操作，但是其中有一项属性不能被修改，例如id，那么只能修改两项属性，userName和email，所以从form表单传递的信息就只能有这两项，我们通常的处理方法是new一个User对象user，用form表单传递的值给user赋值，然后用user作为参数去更新信息，现在由于form表单无法传递id值，那么user.id此时就为null，便无法满足我们要求的更新操作，如下图：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/cgj7k0g7hg0sk8ztr82855xt/image_1b0stovhk9c81hu41fnomvja7k2n.png" alt="image_1b0stovhk9c81hu41fnomvja7k2n.png-61.2kB"><br>　　<br>　　解决这种问题的办法是：对于对象user，我们不采取new的方式，而是使用从数据库中直接获取的方式，这样一来，user中的属性值就是原数据库中存储的属性值，那么用form表单传递过来的userName和email值更新user之后，它的id仍然为原来的值，如下图所示:<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/z63dhvkrfjhp2s4tycmlg0rp/image_1b0su1eligi916uo68cdg8rij34.png" alt="image_1b0su1eligi916uo68cdg8rij34.png-71kB"><br>　　<br>　　@ModelAttribute注解为我们提供了这种解决方法的实现：<strong>使用@ModelAttribute注解的方法，会在调用目标处理方法之前被调用</strong>。下面我们根据先前所说的例子来说明，修改数据库中一条user记录，其中id属性不能修改，数据库相关的操作我们仅采用模拟的方式：<br>　　<br>　index.jsp：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">　&lt;!--  </div><div class="line">		模拟修改操作</div><div class="line">		1. 原始数据为: 1,Jack,Jack@163.com</div><div class="line">		2. 将username和email修改为Mike、Mike@qq.com，id不能被修改.</div><div class="line">		3. 表单回显, 模拟操作直接在表单填写对应的属性值</div><div class="line">	--&gt;</div><div class="line">&lt;form action="springmvc/testModelAttribute" method="Post"&gt;</div><div class="line">		username: &lt;input type="text" name="username" value="Jack"/&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		email: &lt;input type="text" name="email" value="Jack@163.com"/&gt;</div><div class="line">		&lt;br&gt;</div><div class="line">		&lt;input type="submit" value="Submit"/&gt;</div><div class="line">	&lt;/form&gt;</div></pre></td></tr></table></figure></p>
<p>　　<br>controller：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ModelAttribute</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"modelAttribute method"</span>);</div><div class="line">			<span class="comment">// 模拟从数据库中获取对象</span></div><div class="line">			User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"Jack"</span>, <span class="string">"Jack@163.com"</span>);</div><div class="line">			System.out.println(<span class="string">"从数据库中获取一个对象: "</span> + user);</div><div class="line">			map.put(<span class="string">"user"</span>, user);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testModelAttribute"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testModelAttribute</span><span class="params">(User user)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"修改: "</span> + user);</div><div class="line">		<span class="keyword">return</span> SUCCESS;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行后，在控制台输出：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/9gpf3e8s6jz3hu90mkalzvh3/image_1b0u4nqt51qsb1b4019hq1fme1h5cm.png" alt="image_1b0u4nqt51qsb1b4019hq1fme1h5cm.png-21kB"></p>
<p>　　值得注意的是：<br>　　1、被@ModelAttribute标记的方法<strong>会在SpringMVC调用该控制器中任何目标方法之前被调用</strong>，也就是说，getUser()不仅仅只在调用testModelAttribute(User user)之前被调用，当这个控制器中任何目标方法被调用时，getUser()都会在其之前被调用。<br>　　2、getUser()中放置在map中的键值对的键“user”是testModelAttribute(User user)方法中入参类型“User”的首字母小写形式，这是一种最常用的匹配方式，其实还可以通过@ModelAttribute修饰入参，从而使用另一种匹配方式，这些内容我们将在下一篇文章中，通过阅读SpringMVC的源代码，深入理解@ModelAttribute的工作过程，进行更进一步地讨论。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/image/avatar.png"
               alt="Alan" />
          <p class="site-author-name" itemprop="name">Alan</p>
          <p class="site-description motion-element" itemprop="description">Better late than never.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">46</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xiangwanpeng" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2810288024/home" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alan</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/VEN/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/VEN/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/VEN/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"xiangwanpeng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/VEN/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
