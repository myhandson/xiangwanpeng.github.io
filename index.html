<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/VEN/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/VEN/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Better late than never.">
<meta property="og:type" content="website">
<meta property="og:title" content="向万鹏的独立博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="向万鹏的独立博客">
<meta property="og:description" content="Better late than never.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="向万鹏的独立博客">
<meta name="twitter:description" content="Better late than never.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> 向万鹏的独立博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">向万鹏的独立博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/Hibernate的一对多关联关系（单向和双向）/" itemprop="url">
                  Hibernate的一对多关联关系（单向和双向）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-04T20:10:36+08:00" content="2016-12-04">
              2016-12-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/04/Hibernate的一对多关联关系（单向和双向）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/04/Hibernate的一对多关联关系（单向和双向）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　在领域模型中，类与类之间最普遍的关系就是关联关系。在 UML 中，关联是有方向的。以 Customer 和 Order 为例：一个用户能发出多个订单, 而一个订单只能属于一个客户。从 Order 到 Customer 的关联是多对一关联; 而从 Customer 到 Order 是一对多关联。
　　</p>
<h2 id="单向n-1的关联关系"><a href="#单向n-1的关联关系" class="headerlink" title="单向n-1的关联关系"></a>单向n-1的关联关系</h2><p>　　单向 n-1 关联只需从 n 的一端可以访问 1 的一端。<br>　　<strong>域模型：</strong>从 Order 到 Customer 的多对一单向关联需要在Order 类中定义一个 Customer 属性，而在 Customer 类中无需定义存放 Order 对象的集合属性。<br>　　<strong>关系数据模型：</strong> ORDERS 表中的 CUSTOMER_ID 参照 CUSTOMER 表的主键。（外键）<br>　　Hibernate 使用 <many-to-one> 元素来映射多对一关联关系。<br>　　例如，在Customer和Order的例子中，首先创建两个类文件：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Integer customerId;</div><div class="line">	<span class="keyword">private</span> String customerName;</div><div class="line">	</div><div class="line">	<span class="comment">//getters and setters</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Integer orderId;</div><div class="line">	<span class="keyword">private</span> String orderName;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Customer customer;</div><div class="line">	</div><div class="line">	<span class="comment">//getters and setters</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></many-to-one></p>
<p>生成hibernate映射文件：</p>
<p>Customer.hbm.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></div><div class="line">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.atguigu.hibernate.entities.n21.Customer"</span> <span class="attr">table</span>=<span class="string">"CUSTOMERS"</span>&gt;</span></div><div class="line">    </div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"customerId"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"CUSTOMER_ID"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">    </div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"customerName"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"CUSTOMER_NAME"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Order.hbm.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></div><div class="line">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.atguigu.hibernate.entities.n21"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Order"</span> <span class="attr">table</span>=<span class="string">"ORDERS"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"orderId"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"ORDER_ID"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"orderName"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"ORDER_NAME"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        </div><div class="line">		<span class="comment">&lt;!-- </span></div><div class="line">			映射多对一的关联关系。 使用 many-to-one 来映射多对一的关联关系 </div><div class="line">			name: 多这一端关联的一那一端的属性的名字</div><div class="line">			class: 一那一端的属性对应的类名</div><div class="line">			column: 一那一端在多的一端对应的数据表中的外键的名字</div><div class="line">		--&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">class</span>=<span class="string">"Customer"</span> <span class="attr">column</span>=<span class="string">"CUSTOMER_ID"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>先随便运行一个程序，来生成数据库表：<br>　<br>customers表<br><img src="http://static.zybuluo.com/xiangwanpeng/yp2cxzzrglfb6eyuooaaba2p/image_1b34sm9cq1m8p194v1e3p1jdlmnk9.png" alt="image_1b34sm9cq1m8p194v1e3p1jdlmnk9.png-21.3kB"></p>
<p>orders表<br><img src="http://static.zybuluo.com/xiangwanpeng/9n0kmfzp3ch5kkuxw4oplo12/image_1b34sn5651s8a1es8j9e1sar1sm2m.png" alt="image_1b34sn5651s8a1es8j9e1sar1sm2m.png-25.8kB"></p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/ww4a7yb5ppl8hg72y2y6vu05/image_1b34snfoddfq15l2mn2i7r5mr13.png" alt="image_1b34snfoddfq15l2mn2i7r5mr13.png-17.7kB"><br>　<br><strong>单向n-1的save操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMany2OneSave</span><span class="params">()</span></span>&#123;</div><div class="line">		Customer customer = <span class="keyword">new</span> Customer();</div><div class="line">		customer.setCustomerName(<span class="string">"AA"</span>);</div><div class="line">		</div><div class="line">		Order order1 = <span class="keyword">new</span> Order();</div><div class="line">		order1.setOrderName(<span class="string">"ORDER-1"</span>);</div><div class="line">		</div><div class="line">		Order order2 = <span class="keyword">new</span> Order();</div><div class="line">		order2.setOrderName(<span class="string">"ORDER-2"</span>);</div><div class="line">		</div><div class="line">		<span class="comment">//设定关联关系</span></div><div class="line">		order1.setCustomer(customer);</div><div class="line">		order2.setCustomer(customer);</div><div class="line">		</div><div class="line">		<span class="comment">//执行  save 操作: 先插入 Customer, 再插入 Order, 3 条 INSERT</span></div><div class="line">		<span class="comment">//先插入 1 的一端, 再插入 n 的一端, 只有 INSERT 语句.</span></div><div class="line">		session.save(customer);</div><div class="line">		</div><div class="line">		session.save(order1);</div><div class="line">		session.save(order2);</div><div class="line">		</div><div class="line">		<span class="comment">//先插入 Order, 再插入 Customer. 3 条 INSERT, 2 条 UPDATE</span></div><div class="line">		<span class="comment">//先插入 n 的一端, 再插入 1 的一端, 会多出 UPDATE 语句!</span></div><div class="line">		<span class="comment">//因为在插入多的一端时, 无法确定 1 的一端的外键值. 所以只能等 1 的一端插入后, 再额外发送 UPDATE 语句.</span></div><div class="line">		<span class="comment">//推荐先插入 1 的一端, 后插入 n 的一端</span></div><div class="line">		<span class="comment">//session.save(order1);</span></div><div class="line">		<span class="comment">//session.save(order2);</span></div><div class="line">		</div><div class="line">		<span class="comment">//session.save(customer);</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行程序，可以成功插入记录，并且在控制台只会打印三条insert语句：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/ot3otmy98s9o8luusyjd0pzl/image_1b34t38nn1q6e1lavbqclas1oka1g.png" alt="image_1b34t38nn1q6e1lavbqclas1oka1g.png-11.8kB"></p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/i3copghkmaep4p53mzz4td9u/image_1b34t3h021na01pbno00vp01g4m1t.png" alt="image_1b34t3h021na01pbno00vp01g4m1t.png-11.7kB"></p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/69b3y4gvzeci42mjm195f9zj/image_1b34t4fap1gq41b5in52i8v1vmd2a.png" alt="image_1b34t4fap1gq41b5in52i8v1vmd2a.png-37.4kB"></p>
<p>但是，如果注释掉倒数4，5，6行的代码，而使用最后的三行代码，即先保存order1和order2，再保存customer，同样也可以成功插入，但是除了会输出三行insert语句，还会输出两行update语句。如下图：<br><img src="http://static.zybuluo.com/xiangwanpeng/3i1ti1hre5qdhkri5vm6xmtq/image_1b34tf2baivg10kv1bplc931npu2n.png" alt="image_1b34tf2baivg10kv1bplc931npu2n.png-28.7kB"><br>　<br>这是因为在先插入order记录时，无法确定外键值customer_id，只能先置为null，所以只能等customer记录插入后，再额外发送 UPDATE 语句去更新customer_id。所以，建议先插入1的那一端，即customer，后插入n的这一端，即order。</p>
<p><strong>单向n-1的get操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMany2OneGet</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//1. 若查询多的一端的一个对象, 则默认情况下, 只查询了多的一端的对象. 而没有查询关联的 1 的那一端的对象!</span></div><div class="line">		Order order = (Order) session.get(Order.class, <span class="number">1</span>);</div><div class="line">		System.out.println(order.getOrderName()); </div><div class="line">		</div><div class="line">		System.out.println(order.getCustomer().getClass().getName());</div><div class="line">		</div><div class="line">		<span class="comment">//session.close();</span></div><div class="line">		</div><div class="line">		<span class="comment">//2. 只有在需要使用到关联的对象时, 才发送对应的 SQL 语句. </span></div><div class="line">		Customer customer = order.getCustomer();</div><div class="line">		System.out.println(customer.getCustomerName()); </div><div class="line">		<span class="comment">//3. 在查询 Customer 对象时, 由多的一端导航到 1 的一端时, </span></div><div class="line">		<span class="comment">//若此时 session 已被关闭, 则默认情况下</span></div><div class="line">		<span class="comment">//会发生 LazyInitializationException 异常</span></div><div class="line">		</div><div class="line">		<span class="comment">//4. 获取 Order 对象时, 默认情况下, 其关联的 Customer 对象是一个代理对象!</span></div><div class="line">		</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>在n-1的get操作中，使用了懒加载机制。如果查询的是order对象，则默认情况下不会立即查找对应的customer对象，而只有等到需要使用这个customer对象时，才会发送select语句查询该customer对象。那么当然，如果在使用该对象之前，session被关闭了，也会抛出懒加载异常。</p>
<p><strong>单向n-1的update操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</div><div class="line">		Order order = (Order) session.get(Order.class, <span class="number">1</span>);</div><div class="line">		order.getCustomer().setCustomerName(<span class="string">"AAA"</span>);</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p><strong>单向n-1的delete操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//在不设定级联关系的情况下, 且 1 这一端的对象有 n 的对象在引用, 不能直接删除 1 这一端的对象</span></div><div class="line">		Customer customer = (Customer) session.get(Customer.class, <span class="number">1</span>);</div><div class="line">		session.delete(customer); </div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>在不设定级联关系的情况下，且 1 这一端的对象有 n 的对象在引用，则不能直接删除 1 这一端的对象。我们可以在customer映射文件的set节点中设置级联属性为级联删除，就可以直接删除1这一端的对象：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">table</span>=<span class="string">"ORDERS"</span> <span class="attr">cascade</span>=<span class="string">"delete"</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>除了级联删除之外，还有其他的级联属性，如下图所示：<br><img src="http://static.zybuluo.com/xiangwanpeng/22ncw1f6kv5l7w7tfuy980o0/image_1b352uke6ftd1kj45n93jejci4o.png" alt="image_1b352uke6ftd1kj45n93jejci4o.png-217.9kB"></p>
<p>但是在开发时并不建议设定级联属性，而建议使用手工的方式来处理。
　</p>
<h2 id="双向1-n的关联关系"><a href="#双向1-n的关联关系" class="headerlink" title="双向1-n的关联关系"></a>双向1-n的关联关系</h2><p>　　双向 1-n 与双向 n-1 是完全相同的两种情形。<br>　　双向 1-n 需要在1的一端可以访问n的一端,反之亦然。<br>　　<strong>域模型:</strong>从Order到Customer的多对一双向关联需要在Order类中定义一个Customer属性,而在Customer类中需定义存放Order对象的集合属性。<br>　　<strong>关系数据模型:</strong> ORDERS表中的CUSTOMER_ID参照CUSTOMER表的主键。（外键）<br>　　<br>几个注意点：</p>
<ol>
<li>当 Session从数据库中加载Java集合时，创建的是Hibernate内置集合类的实例，因此在持久化类中定义集合属性时必须把属性声明为Java 接口类型，例如应该声明为Set而不是HashSet。Hibernate 的内置集合类具有集合代理功能，支持延迟检索策略。类似于在单向n-1关系的get操作，如果在双向1-n的get操作中获取了customer对象，如果不使用它存放order的集合，那么这个集合就不会被加载，只有使用到时才会加载。</li>
<li><p>在customer类中定义集合属性时，通常把它初始化为集合实现类的一个实例，这样可以提高程序的健壮性，避免应用程序访问取值为null的集合的方法抛出NullPointerException。</p>
<p>Hibernate 使用 <set>元素来映射set类型的属性。下面我们仍以customer和order的例子来测试，首先创建两个类：</set></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Integer customerId;</div><div class="line">	<span class="keyword">private</span> String customerName;</div><div class="line">	</div><div class="line">	<span class="comment">/*</span></div><div class="line">	 * 1. 声明集合类型时, 需使用接口类型, 因为 hibernate 在获取</div><div class="line">	 * 集合类型时, 返回的是 Hibernate 内置的集合类型, 而不是 JavaSE 一个标准的集合实现. </div><div class="line">	 * 2. 需要把集合进行初始化, 可以防止发生空指针异常</div><div class="line">	 */</div><div class="line">	<span class="keyword">private</span> Set&lt;Order&gt; orders = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">	</div><div class="line">	<span class="comment">//getters and setters</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Integer orderId;</div><div class="line">	<span class="keyword">private</span> String orderName;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Customer customer;</div><div class="line">	</div><div class="line">	<span class="comment">//getters and setters</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>生成Hibernate映射文件：</p>
<p>Order.hbm.xml（和单向n-1相同）<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></div><div class="line">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.atguigu.hibernate.entities.n21.both"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Order"</span> <span class="attr">table</span>=<span class="string">"ORDERS"</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"orderId"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"ORDER_ID"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"orderName"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"ORDER_NAME"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        </div><div class="line">		<span class="comment">&lt;!-- </span></div><div class="line">			映射多对一的关联关系。 使用 many-to-one 来映射多对一的关联关系 </div><div class="line">			name: 多这一端关联的一那一端的属性的名字</div><div class="line">			class: 一那一端的属性对应的类名</div><div class="line">			column: 一那一端在多的一端对应的数据表中的外键的名字</div><div class="line">		--&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">class</span>=<span class="string">"Customer"</span> <span class="attr">column</span>=<span class="string">"CUSTOMER_ID"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Customer.hbm.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></div><div class="line">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.atguigu.hibernate.entities.n21.both"</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Customer"</span> <span class="attr">table</span>=<span class="string">"CUSTOMERS"</span>&gt;</span></div><div class="line">    </div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"customerId"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"CUSTOMER_ID"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">    </div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"customerName"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"CUSTOMER_NAME"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="comment">&lt;!-- 映射 1 对多的那个集合属性 --&gt;</span></div><div class="line">        <span class="comment">&lt;!-- set: 映射 set 类型的属性, name:一的这一端关联的多的那一端的属性名,table: set 中的元素对应的记录放在哪一个数据表中. 该值需要和多对一的多的那个表的名字一致 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">table</span>=<span class="string">"ORDERS"</span>&gt;</span></div><div class="line">        	<span class="comment">&lt;!-- 指定关联的表中的外键列的名字 --&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"CUSTOMER_ID"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">        	<span class="comment">&lt;!-- 指定映射类型 --&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Order"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>生成的数据库表的结构和单向n-1中相同，现在来测试各种方法：</p>
<p><strong>双向1-n的save操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOne2ManySave</span><span class="params">()</span></span>&#123;</div><div class="line">		Customer customer = <span class="keyword">new</span> Customer();</div><div class="line">		customer.setCustomerName(<span class="string">"AA"</span>);</div><div class="line">		</div><div class="line">		Order order1 = <span class="keyword">new</span> Order();</div><div class="line">		order1.setOrderName(<span class="string">"ORDER-1"</span>);</div><div class="line">		</div><div class="line">		Order order2 = <span class="keyword">new</span> Order();</div><div class="line">		order2.setOrderName(<span class="string">"ORDER-2"</span>);</div><div class="line">		</div><div class="line">		<span class="comment">//设定关联关系</span></div><div class="line">		order1.setCustomer(customer);</div><div class="line">		order2.setCustomer(customer);</div><div class="line">		</div><div class="line">		customer.getOrders().add(order1);</div><div class="line">		customer.getOrders().add(order2);</div><div class="line">		</div><div class="line">		<span class="comment">//执行  save 操作: 先插入 Customer, 再插入 Order, 3 条 INSERT, 2 条 UPDATE</span></div><div class="line">		<span class="comment">//因为 1 的一端和 n 的一端都维护关联关系. 所以会多出 UPDATE</span></div><div class="line">		<span class="comment">//可以在 1 的一端的 set 节点指定 inverse=true, 来使 1 的一端放弃维护关联关系!</span></div><div class="line">		<span class="comment">//建议设定 set 的 inverse=true, 建议先插入 1 的一端, 后插入多的一端</span></div><div class="line">		<span class="comment">//好处是不会多出 UPDATE 语句</span></div><div class="line">		session.save(customer);</div><div class="line">		</div><div class="line">		session.save(order1);</div><div class="line">		session.save(order2);</div><div class="line">		</div><div class="line">		<span class="comment">//先插入 Order, 再插入 Cusomer, 3 条 INSERT, 4 条 UPDATE</span></div><div class="line">		<span class="comment">//session.save(order1);</span></div><div class="line">		<span class="comment">//session.save(order2);</span></div><div class="line">		</div><div class="line">		<span class="comment">//session.save(customer);</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当我们使用倒数第4，5，6行代码进行插入，即先保存customer，再保存order1和order2，这不同于单向n-1中的操作，虽然插入都是成功的，但是此处除了会打印三条insert语句，还会打印两条update语句：<br><img src="http://static.zybuluo.com/xiangwanpeng/juefw7x1aqms4xnczrb8v7bf/image_1b3509k521lab126n1k8fmk5v5934.png" alt="image_1b3509k521lab126n1k8fmk5v5934.png-26.1kB"></p>
<p>这是因为， 由于是双向的关联关系，所以 1 的一端和 n 的一端都需要维护关联关系。当先插入customer对象后，customer中的set集合里面的order的id也还未知，会先被置为null，所以当order1和order2被插入后，会多出两条update语句。那么可以推测出，如果注释掉倒数第4，5，6行代码，而执行最后三行代码，那么除了有三条insert语句，还会打印出4条update语句，因为order1和order2先各维护一次，customer会再维护两次。如下图：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/420934o0zv40u0u9z90v9d0p/image_1b350gg27r8e1foo45umhn1khs3h.png" alt="image_1b350gg27r8e1foo45umhn1khs3h.png-30kB"></p>
<p>　　那么，如果我们不希望两端都维护关联关系，该怎么办呢？<br>　　解决办法是，在hibernate的配置文件中可以通过设置inverse属性来决定是由双向关联的哪一方来维护表和表之间的关系。inverse = false的为主动方，inverse = true 的为被动方。由主动方负责维护关 联关系。在没有设置inverse属性的情况下，默认父子两边都维护父子关系。<br>　　在双向 1-n 关系中，将 n 方设为主控方将有助于性能改善，而如果将 1 方设为主控方会额外多出update语句。这好比如果要国家元首记住全国人民的名字不太现实，但要让全国人民知道国家元首，就容易得多。<br>　　例如，现在我们在Customer.hbm.xml映射文件中设置set节点为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">table</span>=<span class="string">"ORDERS"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后在test方法中先插入customer，再插入order1和order2，则只会打印三条insert语句，而不会打印update语句：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/bbq6j8lirhwm7x2xjwqoovpi/image_1b3510fhr1i82j7n1krfi6ufcf3u.png" alt="image_1b3510fhr1i82j7n1krfi6ufcf3u.png-32.6kB"></p>
<p><strong>双向1-n的get操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOne2ManyGet</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//1. 对 n 的一端的集合使用延迟加载</span></div><div class="line">		Customer customer = (Customer) session.get(Customer.class, <span class="number">7</span>);</div><div class="line">		System.out.println(customer.getCustomerName()); </div><div class="line">		<span class="comment">//2. 返回的多的一端的集合时 Hibernate 内置的集合类型. </span></div><div class="line">		<span class="comment">//该类型具有延迟加载和存放代理对象的功能. </span></div><div class="line">		System.out.println(customer.getOrders().getClass()); </div><div class="line">		</div><div class="line">		<span class="comment">//session.close();</span></div><div class="line">		<span class="comment">//3. 可能会抛出 LazyInitializationException 异常 </span></div><div class="line">		</div><div class="line">		System.out.println(customer.getOrders().size()); </div><div class="line">		</div><div class="line">		<span class="comment">//4. 再需要使用集合中元素的时候进行初始化. </span></div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>　　与单向n-1的get操作类似，在双向1-n的get操作中，如果先加载了customer对象，在使用它的orders集合之前，是不会加载orders集合的，这使用了懒加载机制，那么同样，也有可能抛出懒加载异常。<br>　　<br>　　<br><strong>双向1-n的update操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdat2</span><span class="params">()</span></span>&#123;</div><div class="line">		Customer customer = (Customer) session.get(Customer.class, <span class="number">1</span>);</div><div class="line">		customer.getOrders().iterator().next().setOrderName(<span class="string">"GGG"</span>); </div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>可以通过1这一端的customer来更新n那一端的order。<br>　<br><strong>双向1-n的delete操作：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//在不设定级联关系的情况下, 且 1 这一端的对象有 n 的对象在引用, 不能直接删除 1 这一端的对象</span></div><div class="line">		Customer customer = (Customer) session.get(Customer.class, <span class="number">1</span>);</div><div class="line">		session.delete(customer); </div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>同单向n-1中一样，在不设定级联关系的情况下，且 1 这一端的对象有 n 的对象在引用，则不能直接删除 1 这一端的对象。<br>　<br>　<br>　　此外，我们还可以在customer映射文件的set节点中设置order-by属性， 在查询时对集合中的元素进行排序，order-by 中使用的是表的字段名， 而不是持久化类的属性名。例如，对orders集合根据orderName进行降序排列：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"orders"</span> <span class="attr">table</span>=<span class="string">"ORDERS"</span> <span class="attr">order-by</span>=<span class="string">"ORDER_NAME DESC"</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>　　最后补充一下，关于双向1-n的两个类的映射文件中，属性的对应关系，如下图所示：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/s40rysetw1jqovp4xuec6fij/image_1b3523tsj1ueu10p2bu7n031bms4b.png" alt="image_1b3523tsj1ueu10p2bu7n031bms4b.png-177.1kB"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/Hibernate映射组成关系/" itemprop="url">
                  Hibernate映射组成关系
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-04T15:40:07+08:00" content="2016-12-04">
              2016-12-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/04/Hibernate映射组成关系/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/04/Hibernate映射组成关系/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　建立域模型和关系数据模型有着不同的出发点。<br>　　域模型（面向对象设计）:由程序代码组成，通过细化持久化类的的粒度可提高代码的可重用性，简化编程。<br>　　关系数据模型（数据库设计）：在没有数据冗余的情况下，应该尽可能减少表的数目，简化表之间的参照关系，以便提高数据的访问速度。<br>　　<br>　　在这篇文章中我们以Worker（工人）和Pay（薪酬）之间的关系为例进行说明：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/wtnzb9aa5ds6edeg1rbujv0u/image_1b34cojeh1ua6193h6cg128t9fc9.png" alt="image_1b34cojeh1ua6193h6cg128t9fc9.png-37.2kB"><br>　　<br>　　Hibernate 把持久化类的属性分为两种:<br>　　<strong>值(value)类型：</strong>没有OID，不能被单独持久化，生命周期依赖于所属的持久化类的对象的生命周期。<br>　　<strong>实体(entity)类型：</strong>有OID，可以被单独持久化，有独立的生命周期。<br>　　<br>　　显然在上述例子中Worker为实体类型，Pay为值类型。如果我们将这两个类根据组成关系映射为数据库中的一张表而不是两张表，那么单表查询的速度是要快于多表查询的。<br>　　Hibernate 使用 &lt;component&gt; 元素来映射组成关系, 该元素表明 pay 属性是 Worker 类一个组成部分, 在 Hibernate 中称之为组件。<br>　　<br>　　下面进行测试，首先新建两个java类：<br>　　<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Integer id;</div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> Pay pay;</div><div class="line"></div><div class="line">　　<span class="comment">//getters and setters</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pay</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> monthlyPay;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> yearPay;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> vocationWithPay;</div><div class="line">	</div><div class="line">	<span class="comment">//getters and setters</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>生成映射文件Worker.hbm.xml，并在映射文件中映射组成关系：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 映射组成关系 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">"pay"</span> <span class="attr">class</span>=<span class="string">"Pay"</span>&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">parent</span> <span class="attr">name</span>=<span class="string">"worker"</span>/&gt;</span></div><div class="line">        	<span class="comment">&lt;!-- 指定组成关系的组件的属性 --&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"monthlyPay"</span> <span class="attr">column</span>=<span class="string">"MONTHLY_PAY"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"yearPay"</span> <span class="attr">column</span>=<span class="string">"YEAR_PAY"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"vocationWithPay"</span> <span class="attr">column</span>=<span class="string">"VOCATION_WITH_PAY"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">component</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>编写测试程序：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testComponent</span><span class="params">()</span></span>&#123;</div><div class="line">		Worker worker = <span class="keyword">new</span> Worker();</div><div class="line">		Pay pay = <span class="keyword">new</span> Pay();</div><div class="line">		</div><div class="line">		pay.setMonthlyPay(<span class="number">1000</span>);</div><div class="line">		pay.setYearPay(<span class="number">80000</span>); </div><div class="line">		pay.setVocationWithPay(<span class="number">5</span>);</div><div class="line">		</div><div class="line">		worker.setName(<span class="string">"ABCD"</span>);</div><div class="line">		worker.setPay(pay);</div><div class="line">		</div><div class="line">		session.save(worker);</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行程序，发现生成了一张数据表worker：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/oxzov30sotvxboalu8uvu264/image_1b34ddp4h2vf1b6p1p7ji341u32m.png" alt="image_1b34ddp4h2vf1b6p1p7ji341u32m.png-20.1kB"></p>
<p>并且成功插入了记录：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/6m6xfxj1gm5r1cha4uye4z3x/image_1b34dfjo817uu1rg55kf37e1a3o13.png" alt="image_1b34dfjo817uu1rg55kf37e1a3o13.png-11.6kB"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/Java时间和日期类型的Hibernate映射/" itemprop="url">
                  Java时间和日期类型的Hibernate映射
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-04T15:05:24+08:00" content="2016-12-04">
              2016-12-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/04/Java时间和日期类型的Hibernate映射/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/04/Java时间和日期类型的Hibernate映射/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　在Java中，代表时间和日期的类型包括：java.util.Date和java.util.Calendar。此外在JDBC API中还提供了3个扩展了java.util.Date类的子类：java.sql.Date，java.sql.Time和java.sql.Timestamp，这三个类分别和标准SQL类型中的 DATE，TIME和TIMESTAMP类型对应。<br>　　在标准SQL中，DATE类型表示日期，TIME 类型表示时间，TIMESTAMP 类型表示时间戳，同时包含日期和时间信息。<br>　　<br>　　通常的映射方法为：<br>　　<br>　　因为java.util.Date是java.sql.Date，java.sql.Time和java.sql.Timestamp的父类，所以java.util.Date可以对应标准SQL类型中的DATE，TIME和TIMESTAMP。所以通常<strong>在持久化类中</strong>将时间日期类型<strong>设置为java.util.Date</strong>。<br>　　然后通过Hibernate映射文件的property节点的type属性进行映射，例如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">type</span>=<span class="string">"timestamp"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"DATE"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">type</span>=<span class="string">"date"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"DATE"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">type</span>=<span class="string">"time"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"DATE"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>其中 timestamp，date，time 既不是 Java 类型，也不是标准 SQL 类型，而是Hibernate映射类型。关于Hibernate映射类型，我们在介绍映射文件的时候提到过，它是连接Java类型和SQL类型的桥梁，三者之间的关系如下：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/09ahhwbvuy1nwbzajoa24o25/image_1b34b3km1m701abc1cq8bfqjlv9.png" alt="image_1b34b3km1m701abc1cq8bfqjlv9.png-153kB"><br><img src="http://static.zybuluo.com/xiangwanpeng/vkoh34sohk9e4fjrhhk8b7mf/image_1b34b4l8n1mstuf088pc261qpem.png" alt="image_1b34b4l8n1mstuf088pc261qpem.png-94.2kB"></p>
<p>现在测试一下，首先在News.java中指定字段Date为java.util.Date类型：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Date date;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getDate</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> date;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(Date date)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.date = date;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>然后在映射文件中映射为time类型：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">type</span>=<span class="string">"time"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"DATE"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>编写测试程序：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPropertyUpdate</span><span class="params">()</span></span>&#123;</div><div class="line">		News news = (News) session.get(News.class, <span class="number">1</span>);</div><div class="line">		</div><div class="line">		System.out.println(news);</div><div class="line">		System.out.println(news.getDate().getClass()); </div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行程序，发现生成的news表中的DATE确实为time类型：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/qnpp2z61niiabiv9af398656/image_1b34bhn1e11a61s5m17ac18701kfj13.png" alt="image_1b34bhn1e11a61s5m17ac18701kfj13.png-15.5kB"></p>
<p>并且在控制台输出了java类型为java.sql.Time：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/cj0rafewkb3053fsucfx0q98/image_1b34bl66u14b81frmuqmtv1fqn1g.png" alt="image_1b34bl66u14b81frmuqmtv1fqn1g.png-22.8kB"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/Hibernate映射文件/" itemprop="url">
                  Hibernate映射文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-04T13:27:36+08:00" content="2016-12-04">
              2016-12-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/04/Hibernate映射文件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/04/Hibernate映射文件/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="POJO-类和数据库的映射文件-hbm-xml"><a href="#POJO-类和数据库的映射文件-hbm-xml" class="headerlink" title="POJO 类和数据库的映射文件*.hbm.xml"></a>POJO 类和数据库的映射文件*.hbm.xml</h2><p>　　POJO类和关系数据库之间的映射可以用一个XML文档来定义。<br>　　通过POJO类的数据库映射文件，Hibernate可以理解持久化类和数据表之间的对应关系，也可以理解持久化类属性与数据库表列之间的对应关系。在运行时 Hibernate 将根据这个映射文件来生成各种SQL语句，映射文件的扩展名为 .hbm.xml。</p>
<h2 id="映射文件说明"><a href="#映射文件说明" class="headerlink" title="映射文件说明"></a>映射文件说明</h2><ul>
<li>hibernate-mapping<ul>
<li>类层次：class<br>-主键：id<br>-基本类型:property<br>-实体引用类: many-to-one  |  one-to-one<br>-集合:set | list | map | array<br>　one-to-many<br>　many-to-many<br>-子类:subclass | joined-subclass<br>-其它:component | any 等
　</li>
<li>查询语句:query（用来放置查询语句，便于对数据库查询的统一管理和优化）
　</li>
</ul>
</li>
</ul>
<p>下面对各个节点进行介绍</p>
<p><strong>hibernate-mapping</strong><br><img src="http://static.zybuluo.com/xiangwanpeng/jyw6iu3rugw2xeefm5ixe1pn/image_1b346btk31o238fa1j1u1j61n049.png" alt="image_1b346btk31o238fa1j1u1j61n049.png-84.1kB"><br>　<br><strong>class</strong><br><img src="http://static.zybuluo.com/xiangwanpeng/2xg4ijtfoapq14lo5xossvtc/image_1b346dve91mo81m0d17un1uhvcrpm.png" alt="image_1b346dve91mo81m0d17un1uhvcrpm.png-87.6kB"><br>　<br>　<br>在介绍下面的节点之前先来介绍一下<strong>映射对象标识符</strong>：</p>
<ul>
<li>Hibernate使用对象标识符(OID)来建立内存中的对象和数据库表中记录的对应关系，对象的OID和数据表的主键对应，Hibernate通过标识符生成器来为主键赋值。</li>
<li>Hibernate 推荐在数据表中使用代理主键，即不具备业务含义的字段，代理主键通常为整数类型，因为整数类型比字符串类型要节省更多的数据库空间。</li>
<li>在对象-关系映射文件中， &lt;id&gt;元素用来设置对象标识符. &lt;generator&gt;子元素用来设定标识符生成器。</li>
<li>Hibernate提供了标识符生成器接口：IdentifierGenerator，并提供了各种内置实现。<br>　<br><strong>id</strong><br><img src="http://static.zybuluo.com/xiangwanpeng/fuubabhwvogmriv4yaj6v1hz/image_1b346frg8kpu1uui1vcf16961fk313.png" alt="image_1b346frg8kpu1uui1vcf16961fk313.png-51.2kB"><br>　<br><strong>generator</strong><br><img src="http://static.zybuluo.com/xiangwanpeng/wevodqbnrsq5hti2apkrkrio/image_1b346ha6bv66hht1vk9bku10fa1g.png" alt="image_1b346ha6bv66hht1vk9bku10fa1g.png-8.4kB"><br>　<br>下面是hibernate提供的内置标识符生成器：<br><img src="http://static.zybuluo.com/xiangwanpeng/sb1rzrkolgog947coiwcx3wj/image_1b346u22q660j8g1igs1mt81k1n2n.png" alt="image_1b346u22q660j8g1igs1mt81k1n2n.png-63.5kB">
　</li>
<li><p>increment 标识符生成器<br>increment标识符生成器由Hibernate以递增的方式为代理主键赋值，Hibernate会先读取NEWS表中的主键的最大值，而接下来向NEWS表中插入记录时，就在max(id)的基础上递增，增量为 1。<br>适用范围:<br>　　由于increment生存标识符机制不依赖于底层数据库系统，因此它适合所有的数据库系统。<br>　　适用于只有单个Hibernate应用进程访问同一个数据库的场合， 在集群环境下不推荐使用它。（并发问题）<br>　　OID必须为long，int或short类型，如果把OID定义为byte类型，在运行时会抛出异常 。</p>
</li>
<li><p>identity 标识符生成器<br>identity标识符生成器由底层数据库来负责生成标识符，它要求底层数据库把主键定义为自动增长字段类型。<br>适用范围：<br>　　由于identity生成标识符的机制依赖于底层数据库系统，因为要求底层数据库系统必须支持自动正常字段类型，这样的数据库包括：DB2，Mysql，MSSQLServer，Sybase等，不包括oracle。<br>　　OID必须为long，int或short类型，如果把OID定义为byte类型，在运行时会抛出异常。</p>
</li>
<li><p>sequence 标识符生成器<br>sequence标识符生成器利用底层数据库提供的序列来生成标识符。<br>Hibernate在持久化一个News对象时，先从底层数据库的news_seq序列中获得一个唯一的标识号，再把它作为主键值 。<br>适用范围:<br>　　由于sequence生成标识符的机制依赖于底层数据库系统的序列，因此， 要求底层数据库系统必须支持序列。支持序列的数据库包括: DB2， Oracle 等，不包括Mysql。<br>　　OID必须为long，int或short类型，如果把OID定义为byte类型，在运行时会抛出异常。</p>
</li>
<li><p>hilo 标识符生成器<br>hilo标识符生成器由Hibernate按照一种“high/low”算法生成标识符。<br>Hibernate在持久化一个News对象时，由Hibernate负责生成主键值。hilo 标识符生成器在生成标识符时，需要<strong>读取并修改</strong>HI_TABLE表中的NEXT_VALUE值。<br>适用范围:<br>　　由于hilo生存标识符机制不依赖于底层数据库系统，因此它适合所有的数据库系统。<br>　　OID必须为long，int或short类型，如果把OID定义为byte类型，在运行时会抛出异常。</p>
</li>
<li><p>native 标识符生成器 （通常使用的方式）<br>native标识符生成器依据底层数据库对自动生成标识符的支持能力，来选择使用identity，sequence或hilo标识符生成器。<br>适用范围:<br>　　由于native能根据底层数据库系统的类型，自动选择合适的标识符生成器，因此很适合于跨数据库平台开发。<br>　　OID必须为long，int或short类型，如果把OID定义为byte类型，在运行时会抛出异常。<br>　<br><strong>property</strong><br><img src="http://static.zybuluo.com/xiangwanpeng/d5l3y44josx13lb90tjo79gt/image_1b348es521kk81fev41b1q5m38j34.png" alt="image_1b348es521kk81fev41b1q5m38j34.png-205.5kB"><br><img src="http://static.zybuluo.com/xiangwanpeng/d8fcnhuh7hu81nq7agjynn5b/image_1b348ggd013651lsckqg1ptc1sa03h.png" alt="image_1b348ggd013651lsckqg1ptc1sa03h.png-130.5kB"></p>
</li>
<li><p>派生属性：<br>并不是持久化类的所有属性都直接和表的字段匹配，持久化类的有些属性的值必须在运行时通过计算才能得到，这种属性称为派生属性，下面我们使用property的formular属性来测试派生属性：<br>首先在News.java中添加一个desc字段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//该属性值为： title：author</span></div><div class="line">	<span class="keyword">private</span> String desc;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> desc;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDesc</span><span class="params">(String desc)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.desc = desc;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>然后在News的映射文件中映射派生属性：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 映射派生属性 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"desc"</span> <span class="attr">formula</span>=<span class="string">"(SELECT concat(author, ': ', title) FROM NEWS n WHERE n.id = id)"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFormula</span><span class="params">()</span></span>&#123;</div><div class="line">		News news = (News) session.get(News.class, <span class="number">1</span>);</div><div class="line">		</div><div class="line">		System.out.println(news.getDesc());</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/i2ujp498ug98t9ac3l3fhxty/image_1b34a68661rcq12o4ms3147m1rae3u.png" alt="image_1b34a68661rcq12o4ms3147m1rae3u.png-66.5kB"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/Hibernate配置文件/" itemprop="url">
                  Hibernate配置文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-04T11:16:59+08:00" content="2016-12-04">
              2016-12-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/04/Hibernate配置文件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/04/Hibernate配置文件/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　Hibernate配置文件主要用于配置<strong>数据库连接</strong>和<strong>Hibernate运行时所需的各种属性</strong>。<br>　　每个Hibernate配置文件对应一个Configuration对象。<br>　　Hibernate配置文件可以有以下两种形式：<br>　　1. hibernate.properties<br>　　2. hibernate.cfg.xml （常用形式）
　　</p>
<h2 id="hibernate-cfg-xml的常用属性"><a href="#hibernate-cfg-xml的常用属性" class="headerlink" title="hibernate.cfg.xml的常用属性"></a>hibernate.cfg.xml的常用属性</h2><p><strong>JDBC连接属性</strong></p>
<ul>
<li>connection.username：数据库用户名。</li>
<li>connection.password：数据库用户密码。</li>
<li>connection.driver_class：数据库JDBC驱动。</li>
<li>connection.url：数据库URL。</li>
<li>dialect：配置数据库的方言，根据底层的数据库不同产生不同的sql语句，Hibernate 会针对数据库的特性在访问时进行优化。</li>
</ul>
<p><strong>C3P0数据库连接池属性</strong></p>
<ul>
<li>hibernate.c3p0.max_size:数据库连接池的最大连接数。</li>
<li>hibernate.c3p0.min_size:数据库连接池的最小连接数。</li>
<li>hibernate.c3p0.timeout:数据库连接池中连接对象在多长时间没有使用过后，就应该被销毁。</li>
<li>hibernate.c3p0.idle_test_period:表示<strong>连接池检测线程</strong>多长时间检测一次池内的所有连接对象是否超时。连接本身不会把自己从连接池中移除，而是专门有一个线程按照一定的时间间隔来做这件事，这个线程通过比较连接对象最后一次被使用时间和当前时间的时间差来和timeout做对比，进而决定是否销毁这个连接对象。</li>
<li>hibernate.c3p0.acquire_increment:当数据库连接池中的连接耗尽时, 每一次获取多少个数据库连接。</li>
<li>hibernate.c3p0.max_statements:缓存 Statement 对象的数量。<br>　　下面我们配置C3P0数据源，然后调用session.doWork方法查看获取的连接是否来自于C3P0：<br>首先导入jar包：<br><img src="http://static.zybuluo.com/xiangwanpeng/ne1jyai01xolie1o24m2pluj/image_1b344l62o14ns10s01abf14ic6dj9.png" alt="image_1b344l62o14ns10s01abf14ic6dj9.png-5.9kB"><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置 C3P0 数据源 --&gt;</span></div><div class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.c3p0.max_size"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.c3p0.min_size"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.acquire_increment"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    	</div><div class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.idle_test_period"</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.timeout"</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    	</div><div class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"c3p0.max_statements"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDoWork</span><span class="params">()</span></span>&#123;</div><div class="line">		session.doWork(<span class="keyword">new</span> Work() &#123;</div><div class="line">			</div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Connection connection)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">				System.out.println(connection); </div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>运行结果：<br><img src="http://static.zybuluo.com/xiangwanpeng/sql2bmldw5jr0s0gh6fycvcx/image_1b342n90c1ues1nhkfc3vbcvaj9.png" alt="image_1b342n90c1ues1nhkfc3vbcvaj9.png-37.6kB"></p>
<p><strong>其他属性</strong></p>
<ul>
<li>show_sql：是否将运行期生成的SQL输出到日志以供调试，取值为 true | false。</li>
<li>format_sql：是否将SQL语句转化为格式良好的SQL语句，取值 true | false。</li>
<li>hbm2ddl.auto：在启动和停止时自动地创建，更新或删除数据库模式，取值 create | update | create-drop | validate。</li>
<li>hibernate.jdbc.fetch_size：实质是调用Statement.setFetchSize()方法设定JDBC的Statement读取数据的时候每次从数据库中取出的记录条数。<br>例如一次查询1万条记录，对于Oracle的JDBC驱动来说，是不会一次性把1万条取出来的，而只会取出fetchSize条记录，当结果集遍历完了这些记录以后，再去数据库取fetchSize条数据，因此大大节省了无谓的内存消耗。fetch Size设的越大，读数据库的次数越少，速度越快，但是对web服务器资源的消耗越严重；fetchSize越小，读数据库的次数越多，速度越慢，但是对web服务器资源的消耗越小。Oracle数据库的JDBC驱动默认的fetchSize=10，是一个保守的设定，根据测试，当Fetch Size=50时，性能会提升1倍之多，当 fetchSize=100，性能还能继续提升20%，fetchSize继续增大，性能提升的就不显著了。<br>但是并不是所有的数据库都支持Fetch Size特性，例如MySQL就不支持。</li>
<li>hibernate.jdbc.batch_size：设定对数据库进行批量删除，批量更新和批量插入的时候的批次大小，类似于设置缓冲区大小的意思。batchSize 越大，批量操作时向数据库发送sql的次数越少，速度就越快。测试结果是当batchSize=0的时候，使用Hibernate对Oracle数据库删除1万条记录需要25秒，batchSize = 50的时候，删除仅仅需要5秒！Oracle数据库 batchSize=30 的时候比较合适。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/03/数据库事务的隔离级别/" itemprop="url">
                  数据库事务的隔离级别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-03T11:48:46+08:00" content="2016-12-03">
              2016-12-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/03/数据库事务的隔离级别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/03/数据库事务的隔离级别/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　由于事务的ACID特性，即Atomicity、Consistency、Isolation、Durability（原子性、一致性、隔离性、持续性），那么对于同时运行的多个事务，当这些事务访问数据库中相同的数据时，如果没有采取必要的隔离机制，就会导致各种并发问题：</p>
<ul>
<li><strong>脏读：</strong>又称无效数据的读出，是指在数据库访问中，事务T1将某一值修改，然后事务T2读取该值，此后T1因为某种原因撤销对该值的修改，这就导致了T2所读取到的数据是无效的。</li>
<li><strong>不可重复读：</strong>是指在数据库访问中，一个事务范围内两个相同的查询却返回了不同数据。这是由于查询时系统中其他事务修改的提交而引起的。比如事务T1读取某一数据，事务T2读取并修改了该数据，T1为了对读取值进行检验而再次读取该数据，便得到了不同的结果。</li>
<li><strong>幻读：</strong>是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，比如这种修改涉及到表中的“全<br>部数据行”。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入“一行新数据”。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。</li>
</ul>
<p>　　数据库事务的隔离性：数据库系统必须具有隔离并发运行的各个事务的能力，使它们不会相互影响，避免各种并发问题。<br>　　一个事务与其他事务隔离的程度成为隔离级别。数据库规定了多种事务隔离级别，不同隔离级别对应不同的干扰程度，隔离级别越高，数据一致性就越好，但并发性就越弱。<br>　　<br><strong>数据库提供了以下4种事务隔离级别：</strong></p>
<ul>
<li><strong>READ-UNCOMMITTED</strong>（读未提交数据，代号为1）：允许事务读取未被其他事务提交的变更，但不允许更新丢失。如果一个事务已经开始写数据，则另外一个事务则不允许同时进行写操作，但允许其他事务读此行数据。在这种隔离级别下，脏读，不可重复读和幻读的问题都会出现。</li>
<li><strong>READ-COMMITTED</strong>（读已提交数据，代号为2）：只允许事务读取已经被其它事务提交的变更。读取数据的事务允许其他事务继续访问该行数据，但是未提交的写事务将会禁止其他事务访问该行。可以避免脏读，但不可重复读和幻读的问题仍然存在。</li>
<li><strong>REPETABLE-READ</strong>（可重复读，代号为4）：确保事务可以多次从一个字段中读取相同的值，在这个事务持续期间，禁止其它事务对这个字段进行更新。读取数据的事务将会禁止写事务（但允许读事务），写事务则禁止任何其他事务。可以避免脏读和不可重复读，但是不能避免出现幻读。</li>
<li><strong>SERIALIZEABLE</strong>（串行化，代号为8）：确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其它事务对该表执行插入，更新和删除操作，提供严格的事务隔离。它要求事务序列化执行，事务只能一个接着一个地执行，不能并发执行。所有并发问题都可以避免，但性能十分低下。</li>
</ul>
<p>　　Oracle在支持两种事务隔离级别：READ-COMMITTED和SERIALIZEABLE，默认的事务隔离级别为<strong>READ-COMMITTED</strong>。<br>　　Mysql支持四种事务隔离级别，默认的事务隔离级别为<strong>REPETABLE-READ</strong>。<br>　　<br><strong>在Mysql中设置隔离级别：</strong><br>　　每启动一个mysql程序，就会获得一个单独的数据库链接。每个数据库链接都有一个全局变量@@tx_isolation，表示当前的事务隔离级别。<br>　　可以通过select @@tx_isolation;语句查看当前mysql连接的隔离级别，如下图：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/6nwrtatcx5f96p0jcls8509c/image_1b31e6lj31ua01n414kb1usu1g519.png" alt="image_1b31e6lj31ua01n414kb1usu1g519.png-4.7kB"><br>　　<br>　　可以通过set transaction isolation level read committed;语句来设置<strong>当前mysql连接</strong>的隔离级别为read committed。<br>　　可以通过set global transaction isolation level read committed;来设置数据库系统的全局的事务隔离级别为read committed。<br>　　<br><strong>在Hibernate中设置隔离级别：</strong><br>　　JDBC数据库连接使用数据库默认的隔离级别，在Hibernate的配置文件中可以显式的设置其隔离级别，每一个隔离级别对应一个整数（如上述四个括号中注明的代号）。设置方法为在Hibernate.cfg.xml中加入：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.isolation"</span>&gt;</span>[隔离等级编号]<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/03/Hibernate一级缓存——Session/" itemprop="url">
                  Hibernate一级缓存——Session
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-03T09:58:06+08:00" content="2016-12-03">
              2016-12-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/03/Hibernate一级缓存——Session/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/03/Hibernate一级缓存——Session/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Session概述"><a href="#Session概述" class="headerlink" title="Session概述"></a>Session概述</h2><p>　　Session接口是hibernate向应用程序提供的操纵数据库的最主要的接口，它提供了基本的保存，更新，删除和加载（不是查询）Java对象的方法。<br>　　Session具有一个缓存，位于缓存中的对象称为持久化对象，它和数据库中的相关记录对应。Session能够在某些时间点按照缓存中对象的变化来执行相关的SQL语句，来同步更新数据库。站在持久化的角度，Hibernate把对象分为4种状态：持久化状态，临时状态，游离状态和删除状态。Session的特定方法能使对象从一个状态到另一个状态。
　　</p>
<h2 id="Session缓存"><a href="#Session缓存" class="headerlink" title="Session缓存"></a>Session缓存</h2><p>　　在Session集合的实现中包含了一系列的Java集合，这些Java集合构成了Session缓存，只要Session实例没有结束生命周期，且没有清理缓存，则放在缓存中的对象也不会结束生命周期。利用Hibernate的这个一级缓存，能够减少Hibernate应用程序访问数据库的频率。<br>　　<br>　　操作Session缓存有以下几个方法：<br>　　<br>　　<strong>flush()：</strong> Session按照缓存中对象的属性变化来同步更新数据库。这是为了使数据表中的记录和Session缓存中的对象的状态保持一致，为了保持一致，可能会发送对应的SQL语句（不代表会马上修改数据库，只有当事务提交后，才会修改数据库）。<br>　　默认情况下，Session在以下时间点刷新缓存：<br>　　1.显式调用Session的flush()方法；<br>　　2.当应用程序调用Transaction的commit()方法时，先调用Session的flush()方法，再提交事务；<br>　　3.当应用程序执行一些查询（HQL,Criteria）操作时，如果缓存中持久化对象的属性已经发生了变化，会先flush缓存，以保证查询结果能够反映持久化对象的最新状态。<br>　　例外情况: 如果对象使用native生成器生成OID，那么当调用Session 的 save()方法保存对象时，会立即执行向数据库插入该实体的insert语句，因为在save()方法后，必须保证对象的OID是存在的，而由于配置了生成OID的方式为native，那么只有当执行insert语句后才能知道这个OID是多少。<br>　　<br>　　commit() 和 flush() 方法的区别：<br>　　flush方法执行一系列sql语句，但不提交事务；<br>　　commit方法先调用flush()方法，然后提交事务，只有提交事务才意味着对数据库操作永久保存下来。<br>　　<br>　　若希望改变 flush 的默认时间点, 可以通过Session的setFlushMode() 方法显式设定 flush 的时间点。（不常用）<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/c4ipkkyg129pvljrd8fh4igs/image_1b31a43fj1bf8tmb1f8iijaacg9.png" alt="image_1b31a43fj1bf8tmb1f8iijaacg9.png-100.2kB"><br>　　<br>　　<strong>refresh()：</strong><br>　　refresh()方法会强制发送SELECT语句,以使Session缓存中对象的状态和数据表中对应的记录保持一致。<br>　　通常情况下，在进行一次查询后，由于session缓存，第二次查询时，将不再发送SQl语句，但是如果调用的refresh方法，则强制发送sql语句进行查询，以获取当前数据库记录的最新状态。<br>　　<br>　　<strong>clear()：</strong><br>　　清理缓存。调用session.clear()后，缓存中的内容将被清空。</p>
<p> 　　flush(),refresh()和clear()方法的示意图如下：<br> 　　<img src="http://static.zybuluo.com/xiangwanpeng/wfuyy818e9fe4xer7fk2ekmm/image_1b31b54mqtov1rcleppier1bj4m.png" alt="image_1b31b54mqtov1rcleppier1bj4m.png-30.8kB"><br> 　　<br> 　　<br>补充：<br>　　在测试session的refresh方法时，使用了如下代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Before</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">	    Configuration configuration = </div><div class="line">	    <span class="keyword">new</span> Configuration().configure();</div><div class="line">	</div><div class="line">	    ServiceRegistry serviceRegistry = </div><div class="line">				<span class="keyword">new</span> ServiceRegistryBuilder()</div><div class="line">				.applySettings(configuration.getProperties())</div><div class="line">				.buildServiceRegistry();</div><div class="line">				</div><div class="line">		sessionFactory = configuration</div><div class="line">		.buildSessionFactory(serviceRegistry);</div><div class="line">		</div><div class="line">		session = sessionFactory.openSession();</div><div class="line">		</div><div class="line">		transaction = session.beginTransaction();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@After</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</div><div class="line">		transaction.commit();</div><div class="line">		session.close();</div><div class="line">		sessionFactory.close();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRefresh</span><span class="params">()</span></span>&#123;</div><div class="line">		News news = (News) session.get(News.class, <span class="number">1</span>);</div><div class="line">		System.out.println(news);</div><div class="line">		</div><div class="line">		session.refresh(news); </div><div class="line">		System.out.println(news); </div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>　　在testRefresh()方法中的session.refresh(news); 语句前设置断点进行debug，当执行到这条语句之前时，我们手动修改数据库中的id为1的记录的值，然后按F6往下执行，会发现的确在refresh方法后又执行了一次select语句，但是输出的news的值却没有改变。如下图所示：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/uo7rga5f7zdz4cqi5z3f7iz6/image_1b31cfcbo1efcsks6he1sqbmeq13.png" alt="image_1b31cfcbo1efcsks6he1sqbmeq13.png-31.4kB"><br>　　<br>　　这是由于mysql默认的事务隔离级别是REPETABLE_READ，即可重复读，这会确保事务可以多次从一个字段中读取相同的值，在这个事务持续期间，禁止其他事务对这个字段进行更新。所以我们无法看到测试效果，解决方法是在hibernate的配置文件中设置事务的隔离级别为READ_COMMITTED（编号为2）：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 设置 Hibernate 的事务隔离级别 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.isolation"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>　　然后debug即可看到效果：<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/3tce5xyardvryv4kaplu9tom/image_1b31cl8of1bgu5hau30he711l01t.png" alt="image_1b31cl8of1bgu5hau30he711l01t.png-33.9kB"><br>　　<br>　　关于事务的隔离级别，可以参看我的另一边博文<a href="http://blog.csdn.net/xiangwanpeng/article/details/53443766" target="_blank" rel="external">《数据库的事务隔离级别》</a>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/02/在Eclipse下搭建Hibernate框架/" itemprop="url">
                  在Eclipse下搭建Hibernate框架
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-02T17:07:48+08:00" content="2016-12-02">
              2016-12-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hibernate/" itemprop="url" rel="index">
                    <span itemprop="name">Hibernate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/02/在Eclipse下搭建Hibernate框架/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/02/在Eclipse下搭建Hibernate框架/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　实现在Eclipse中搭建一个Hibernate框架。在这里，我使用的数据库是mysql5.5。</p>
<p><strong>1.安装和当前Eclipse版本匹配的Hibernate插件或者JBoss插件：</strong><br>　　在Eclipse中点击Help —&gt; Eclipse Marketplace，搜索JBoss Tools，点击install，选择要安装的JBoss插件（我选择了全部），一路默认即可，安装完后重启Eclipse。<br>　　重新打开Eclipse后，右键New -&gt; Other，输入hibernate会提示<br>　　<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/eh3venr47csgit2iwhufreok/image_1b2vd9s8718mprui1988vl1174l9.png" alt="image_1b2vd9s8718mprui1988vl1174l9.png-28.8kB"><br>　　<br>　　表明Hibernat插件安装成功。<br>　　<br><strong>2.新建项目，并搭建Hibernate环境：</strong><br>　　右键New -&gt; Java Project（仅需测试Hibernate，故没有新建Web Project），右键项目名，New -&gt; Folder，命名为lib，复制需要的hibernate的JAR文件和mysql的JAR文件到该文件夹下：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/f9q80051vz33xmv8mt97mte2/image_1b2vdkqcqblkme7k691h8gqc716.png" alt="image_1b2vdkqcqblkme7k691h8gqc716.png-11.6kB"></p>
<p>　　右键这些jar文件，Build Path -&gt; Add to Build Path。<br>　　<br><strong>3.创建持久化Java类：</strong>（在这里用一个新闻类News.java测试）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">News</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Integer id;</div><div class="line">	<span class="keyword">private</span> String title;</div><div class="line">	<span class="keyword">private</span> String content;</div><div class="line">	<span class="keyword">private</span> Date date;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> id;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.id = id;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> title;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.title = title;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> content;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.content = content;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDate</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> date;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(Date date)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.date = date;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">News</span><span class="params">(String title, String content, Date date)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>();</div><div class="line">		<span class="keyword">this</span>.title = title;</div><div class="line">		<span class="keyword">this</span>.content = content;</div><div class="line">		<span class="keyword">this</span>.date = date;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">News</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// TODO Auto-generated constructor stub</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"News [id="</span> + id + <span class="string">", title="</span> + title + <span class="string">", content="</span> + content + <span class="string">", date="</span> + date + <span class="string">"]"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意点：</p>
<ul>
<li>要提供一个无参构造器。以便Hibernate可以使用Constructor.newInstance()来实例化持久化类。</li>
<li>提供一个标识属性。通常映射为数据库表的主键字段。如果没有该属性，一些功能将不起作用，如：Session.saveOrUpdate()。</li>
<li>为持久化类的字段声明访问方法（get/set）。Hibernate对JavaBeans风格的属性实行持久化。</li>
<li>使用非final类。在运行时生成代理是Hibernate的一个重要的功能。如果持久化类没有实现任何接口，Hibnernate 使用 CGLIB 生成代理。如果使用的是 final 类，则无法生成CGLIB代理。</li>
<li>重写eqauls()和hashCode()方法。如果需要把持久化类的实例放到Set中（当需要进行关联映射时），则应该重写这两个方法。
　</li>
</ul>
<p><strong>4.创建对象-关系映射文件：</strong><br>　　右键持久化类所在的包名，New -&gt; Hibernate XML Mapping file（hbm.xml） -&gt; 选择News类 -&gt; finish，将生成New类对应的对象-关系映射文件News.hbm.xml，把其中&lt;id&gt;下的&lt;generator&gt;的class属性设置为”native”，即指定主键的生成方式为使用数据库的本地方式：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></div><div class="line">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="comment">&lt;!-- Generated 2016-12-2 16:03:18 by Hibernate Tools 3.5.0.Final --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.Hibernate.entities.News"</span> <span class="attr">table</span>=<span class="string">"NEWS"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"ID"</span> /&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 指定主键的生成方式, native: 使用数据库本地方式 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"TITLE"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"CONTENT"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">type</span>=<span class="string">"java.util.Date"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span>=<span class="string">"DATE"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>5.创建Hibernate配置文件：</strong><br>　　右键src目录 -&gt; New -&gt; Hibernate Configuration File -&gt; next，使用默认名字hibernate.cfg.xml，点击finish，然后在该文件中配置数据库连接相关的信息：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></div><div class="line">		"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</div><div class="line">		"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></div><div class="line">    </div><div class="line">		<span class="comment">&lt;!-- 配置连接数据库的基本信息 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.password"</span>&gt;</span>你的数据库密码<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.url"</span>&gt;</span>jdbc:mysql:///数据库名<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		</div><div class="line">		<span class="comment">&lt;!-- 配置 hibernate 的基本信息 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- hibernate 所使用的数据库方言 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span>&gt;</span>org.hibernate.dialect.MySQL5InnoDBDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span>		</div><div class="line">		</div><div class="line">		<span class="comment">&lt;!-- 执行操作时是否在控制台打印 SQL --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	</div><div class="line">		<span class="comment">&lt;!-- 是否对 SQL 进行格式化 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	</div><div class="line">		<span class="comment">&lt;!-- 指定自动生成数据表的策略 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		</div><div class="line">		<span class="comment">&lt;!-- 指定关联的 .hbm.xml 文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/atguigu/hibernate/helloworld/News.hbm.xml"</span>/&gt;</span></div><div class="line">	</div><div class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>6.测试：</strong><br>　　右键 -&gt; New -&gt; JUnit Test Case，用下面的代码测试保存一个New对象到数据库，然后查找该记录并输出。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@org</span>.junit.<span class="function">Test</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> &#123;</div><div class="line">		<span class="comment">//1.创建一个 SessionFactory 对象</span></div><div class="line">		SessionFactory sessionFactory = <span class="keyword">null</span>;</div><div class="line">				</div><div class="line">		<span class="comment">//1).创建Configuration对象:对应hibernate的基本配置信息和对象关系映射信息</span></div><div class="line">		Configuration configuration = <span class="keyword">new</span> Configuration().configure();</div><div class="line">				</div><div class="line">		<span class="comment">// Hibernate4.0之前这样创建</span></div><div class="line">        <span class="comment">//sessionFactory = configuration.buildSessionFactory();</span></div><div class="line">				</div><div class="line">		<span class="comment">//2).创建一个 ServiceRegistry 对象: hibernate 4.x 新添加的对象</span></div><div class="line">		<span class="comment">//hibernate 的任何配置和服务都需要在该对象中注册后才能有效.</span></div><div class="line">		ServiceRegistry serviceRegistry = </div><div class="line">						<span class="keyword">new</span> ServiceRegistryBuilder().applySettings(configuration.getProperties())</div><div class="line">						                            .buildServiceRegistry();</div><div class="line">				</div><div class="line">		<span class="comment">//3).</span></div><div class="line">		sessionFactory = configuration.buildSessionFactory(serviceRegistry);</div><div class="line">				</div><div class="line">		<span class="comment">//2. 创建一个 Session 对象</span></div><div class="line">		Session session = sessionFactory.openSession();</div><div class="line">				</div><div class="line">		<span class="comment">//3. 开启事务</span></div><div class="line">		Transaction transaction = session.beginTransaction();</div><div class="line">				</div><div class="line">		<span class="comment">//4.执行保存和加载操作</span></div><div class="line">		News news = <span class="keyword">new</span> News(<span class="string">"C++"</span>, <span class="string">"zhangsan"</span>, <span class="keyword">new</span> Date(<span class="keyword">new</span> java.util.Date().getTime()));</div><div class="line">		session.save(news);</div><div class="line">		</div><div class="line">		<span class="comment">//加载数据库中id为1的News记录</span></div><div class="line">		News news1 = (News) session.get(News.class, <span class="number">1</span>);</div><div class="line">		System.out.println(news);</div><div class="line">				</div><div class="line">		<span class="comment">//5. 提交事务 </span></div><div class="line">		transaction.commit();</div><div class="line">				</div><div class="line">		<span class="comment">//6. 关闭 Session</span></div><div class="line">		session.close();</div><div class="line">				</div><div class="line">		<span class="comment">//7. 关闭 SessionFactory 对象</span></div><div class="line">		sessionFactory.close();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行代码后，会自动为数据库hibernate1创建一张news表，并添加一条记录：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/ijfksbq78eu5140ph86uyg6v/image_1b2vq99m869b14oo4daes31bsjm.png" alt="image_1b2vq99m869b14oo4daes31bsjm.png-15.5kB"></p>
<p>而且在控制台输出了sql语句以及从数据库中加载的记录：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/or6qgn4k3v0brzq54yeja9gp/image_1b2vqa5vc1fke71h1drr104q1loj13.png" alt="image_1b2vqa5vc1fke71h1drr104q1loj13.png-29.6kB"></p>
<p>　　在test方法中，各个接口的作用为：</p>
<ul>
<li><strong>Configuration接口：</strong><br>　　Configuration 类负责管理 hibernate 的配置信息，包括如下内容：<br>　　<strong>Hibernate 运行的底层信息</strong>：数据库的URL、用户名、密码、JDBC驱动类；<br>　　<strong>数据库Dialect,数据库连接池等</strong>（对应 hibernate.cfg.xml 文件）；<br>　　<strong>持久化类与数据表的映射关系</strong>（对应<em>.hbm.xml 文件）。<br>　<br>　　创建 Configuration 的两种方式：（只一种即可，否则会被覆盖）<br>　　<em>*属性文件（hibernate.properties）:</em></em><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　Configuration cfg = <span class="keyword">new</span> Configuration();</div></pre></td></tr></table></figure>
</li>
</ul>
<p>　　　　<strong>Xml文件（hibernate.cfg.xml）：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　Configuration cfg = <span class="keyword">new</span> Configuration().configure();</div></pre></td></tr></table></figure></p>
<p>　<br>　　　　Configuration 的 configure 方法还支持带参数的访问：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　　File file = <span class="keyword">new</span> File(“<span class="keyword">new</span>.xml”)；</div><div class="line">　　Configuration cfg = <span class="keyword">new</span> Configuration().configure(file);</div></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>SessionFactory接口：</strong><br>　　针对单个数据库映射关系经过编译后的内存镜像，是线程安全的。<br>　　SessionFactory对象一旦构造完毕，即被赋予特定的配置信息。<br>　　SessionFactory是生成Session的工厂。<br>　　构造SessionFactory很消耗资源，一般情况下一个应用中只初始化一个SessionFactory对象。<br>　　Hibernate4新增了一个ServiceRegistry接口，所有基于Hibernate的配置或者服务都必须统一向这个ServiceRegistry  注册后才能生效。<br>　<br>　　Hibernate4中创建SessionFactory的步骤：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//创建Configuration对象</span></div><div class="line">Configuration configuration = <span class="keyword">new</span> Configuration().configure();</div><div class="line"><span class="comment">//创建ServiceRegistry对象</span></div><div class="line">ServiceRegistry serviceRegistry = <span class="keyword">new</span> ServiceRegistryBuilder()</div><div class="line">.applySettings(configuration.getProperties())</div><div class="line">.buildServiceRegistry();</div><div class="line"><span class="comment">//创建SessionFactory对象</span></div><div class="line">SessionFactory sessionFactory = configuration.buildSessionFactory(serviceRegistry);</div></pre></td></tr></table></figure>
</li>
<li><p><strong>Session接口：</strong><br>　　Session 是应用程序与数据库之间交互操作的一个单线程对象，是 Hibernate运作的中心，所有持久化对象必须在session的管理下才可以进行持久化操作。此对象的生命周期很短。Session对象有一个一级缓存，显式执行flush之前，所有的持久层操作的数据都缓存在session对象处。相当于JDBC中的Connection。<br>　　持久化类与 Session关联起来后就具有了持久化的能力。<br>　　Session 类的方法：<br>　　取得持久化对象的方法： get()load()；<br>　　持久化对象都得保存，更新和删除：save(),update(),saveOrUpdate(),delete()；<br>　　开启事务: beginTransaction()；<br>　　管理 Session的方法：isOpen(),flush(),clear(), evict(), close()等。</p>
</li>
<li><p><strong>Transaction接口：</strong><br>　　代表一次原子操作，它具有数据库事务的概念。<br>　　所有持久层都应该在事务管理下进行，即使是只读操作。<br>　　获取Transaction对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Transaction transaction = session.beginTransaction();</div></pre></td></tr></table></figure>
</li>
</ul>
<p>　　　　常用方法:<br>　　　　commit():提交相关联的session实例；<br>　　　　rollback():撤销事务操作；<br>　　　　wasCommitted():检查事务是否提交。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/23/Java设计模式之单例模式/" itemprop="url">
                  Java设计模式之单例模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-23T10:24:49+08:00" content="2016-11-23">
              2016-11-23
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/23/Java设计模式之单例模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/23/Java设计模式之单例模式/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/21/Java设计模式之抽象工厂模式/" itemprop="url">
                  Java设计模式之抽象工厂模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-21T20:54:50+08:00" content="2016-11-21">
              2016-11-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">Java设计模式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/21/Java设计模式之抽象工厂模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/21/Java设计模式之抽象工厂模式/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　工厂模式主要是为创建对象提供过渡接口，以便将创建对象的具体过程屏蔽隔离起来，达到提高灵活性的目的。在<a href="http://blog.csdn.net/xiangwanpeng/article/details/53224034" target="_blank" rel="external">Java设计模式之工厂方法模式</a>中我们讲述了工厂模式中的简单工厂模式和工厂方法模式，在这篇文章中我们将剩下的一个工厂模式——抽象工厂模式。
　　</p>
<h2 id="产品等级结构和产品族"><a href="#产品等级结构和产品族" class="headerlink" title="产品等级结构和产品族"></a>产品等级结构和产品族</h2><p>　　为了更好地理解抽象工厂模式，我们先引入两个概念：<br>　　(1) 产品等级结构：产品等级结构即产品的继承结构，如一个抽象类是电视机，其子类有海尔电视机、海信电视机、TCL电视机，则抽象电视机与具体品牌的电视机之间构成了一个产品等级结构，抽象电视机是父类，而具体品牌的电视机是其子类。<br>　　(2) 产品族：在抽象工厂模式中，产品族是指由同一个工厂生产的，位于不同产品等级结构中的一组产品，如海尔电器工厂生产的海尔电视机、海尔电冰箱，海尔电视机位于电视机产品等级结构中，海尔电冰箱位于电冰箱产品等级结构中，海尔电视机、海尔电冰箱构成了一个产品族。<br>　　<br>　　产品等级结构和产品族的示意图如下：<br>　　<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/evavm5kj9geynyidyfz1eoqy/image_1b24rmo191dhsc8fo4kis51qtn9.png" alt="image_1b24rmo191dhsc8fo4kis51qtn9.png-40.3kB"><br>　　<br>　　在上图中，不同颜色的多个正方形、圆形和椭圆形分别构成了三个不同的产品等级结构，而相同颜色的正方形、圆形和椭圆形构成了一个产品族，每一个形状对象都位于某个产品族，并属于某个产品等级结构。图3中一共有五个产品族，分属于三个不同的产品等级结构。我们只要指明一个产品所处的产品族以及它所属的等级结构，就可以唯一确定这个产品。
　　
　　</p>
<h2 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h2><p>　　当系统所提供的工厂生产的具体产品并不是一个简单的对象，而是多个位于不同产品等级结构、属于不同类型的具体产品时就可以使用抽象工厂模式。抽象工厂模式是所有形式的工厂模式中最为抽象和最具一般性的一种形式。抽象工厂模式与工厂方法模式最大的区别在于，<strong>工厂方法模式</strong>针对的是<strong>一个产品等级结构</strong>，而<strong>抽象工厂模式</strong>需要面对<strong>多个产品等级结构</strong>，一个工厂可以负责多个不同产品等级结构中的产品对象的创建。当一个工厂可以创建出分属于不同产品等级结构的一个产品族中的所有对象时，抽象工厂模式比工厂方法模式更为简单、更有效率。<br>　　<br>　　抽象工厂方法模式UML图如下：<br>　　<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/4yeitu6ysot7f00835k26c9b/image_1b23geh7hqj0rim2ho1kja1bm89.png" alt="image_1b23geh7hqj0rim2ho1kja1bm89.png-128.8kB"><br>　　<br>　　在工厂方法模式中，一个工厂只生产一个产品等级结构的产品，例如在工厂方法模式中讲到的，一个工厂只生产宝马车这一种产品等级结构的产品（不管是BMW320，还是BMW523，都属于同一产品等级结构，即宝马车）。现在设想这样一种情况，既要生产汽车引擎，又要生产汽车方向盘，而且既有宝马品牌的引擎和方向盘，又有奔驰品牌的引擎和方向盘，那么现在就出现了两种产品等级结构，引擎和方向盘，其中宝马品牌的引擎和宝马品牌的方向盘构成一个产品族，奔驰品牌的引擎和奔驰品牌的方向盘构成一个产品族，UML类图如下：<br>　　<br>　　<img src="http://static.zybuluo.com/xiangwanpeng/foeem94xq2e4pu9nd52bzlex/image_1b23ie1jdsoc1epajgv119tih2m.png" alt="image_1b23ie1jdsoc1epajgv119tih2m.png-56.9kB"><br>　　<br>　　当使用工厂方法模式，你可以替换生成引擎的工厂方法，就可以把引擎从宝马换到奔驰。但是用了抽象工厂模式，你只要换家工厂，就可以同时替换引擎和方向盘一套。如果你要的产品有几十个，当然用抽象工厂模式一次替换全部最方便。所以说抽象工厂就像工厂，而工厂方法则像是工厂的一种产品生产线，因为工厂方法模式只有一个抽象产品类，而抽象工厂模式有多个。<br>　　<br>代码如下：</p>
<p>引擎类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEngine</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWEngine</span> <span class="keyword">implements</span> <span class="title">IEngine</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BMWEngine</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"BMWEngine has been created!"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzEngine</span> <span class="keyword">implements</span> <span class="title">IEngine</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BenzEngine</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"BenzEngine has been created!"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>方向盘类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IWheel</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWWheel</span> <span class="keyword">implements</span> <span class="title">IWheel</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BMWWheel</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"BMWWheel has been created!"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzWheel</span> <span class="keyword">implements</span> <span class="title">IWheel</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BenzWheel</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"BenzWheel has been created!"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>工厂类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IFactory</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> IEngine <span class="title">creatEngine</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> IWheel <span class="title">creatWheel</span><span class="params">()</span></span>;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BMWFactory</span> <span class="keyword">implements</span> <span class="title">IFactory</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> IEngine <span class="title">creatEngine</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> BMWEngine();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> IWheel <span class="title">creatWheel</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> BMWWheel();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenzFactory</span> <span class="keyword">implements</span> <span class="title">IFactory</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> IEngine <span class="title">creatEngine</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> BenzEngine();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> IWheel <span class="title">creatWheel</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> BenzWheel();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>客户端测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		IFactory bmwFactory = <span class="keyword">new</span> BMWFactory();</div><div class="line">		IEngine bmwEngine = bmwFactory.creatEngine();</div><div class="line">		IWheel bmwWheel = bmwFactory.creatWheel();</div><div class="line">		</div><div class="line">		IFactory benzFactory = <span class="keyword">new</span> BenzFactory();</div><div class="line">		IEngine benzEngine = benzFactory.creatEngine();</div><div class="line">		IWheel benzWheel = benzFactory.creatWheel();</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<p><img src="http://static.zybuluo.com/xiangwanpeng/mmn23imwiywyao3kbbth9k2x/image_1b23jsfph1ghrr4j8ucu1f7r13.png" alt="image_1b23jsfph1ghrr4j8ucu1f7r13.png-15kB"></p>
<p>总结：</p>
<p>工厂方法模式：<br>　　一个抽象产品类，可以派生出多个具体产品类。<br>　　一个抽象工厂类，可以派生出多个具体工厂类。<br>　　每个具体工厂类只能创建一个具体产品类的实例。<br>　　<br>抽象工厂模式：<br>　　多个抽象产品类，每个抽象产品类可以派生出多个具体产品类。<br>　　一个抽象工厂类，可以派生出多个具体工厂类。<br>　　每个具体工厂类可以创建多个具体产品类的实例。 </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/image/avatar.png"
               alt="Alan" />
          <p class="site-author-name" itemprop="name">Alan</p>
          <p class="site-description motion-element" itemprop="description">Better late than never.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">45</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">61</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xiangwanpeng" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2810288024/home" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alan</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/VEN/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/VEN/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/VEN/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/VEN/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"xiangwanpeng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/VEN/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
